<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Privacy Pass: Architectural Framework</title>
<meta content="Alex Davidson" name="author">
<meta content="
       This document specifies the architectural framework for constructing
secure and privacy-preserving instantiations of the Privacy Pass
protocol (as described in  ). The framework
refers to the entire ecosystem of Privacy Pass clients and servers. This
document makes recommendations on how this ecosystem should be
constructed to ensure the privacy of clients and the security of all
participating entities. 
    " name="description">
<meta content="xml2rfc 2.39.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-davidson-pp-architecture-latest" name="ietf.draft">
<link href="draft-davidson-pp-architecture.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 624px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  line-height: 17px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #eee;
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  font-style: italic;
  margin: 0.3em 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 600px) {
  #authors-addresses > section {
    display: relative;
    padding: 32px 0 0;
    column-count: 2;
    column-gap: 20px;
  }
  #name-authors-addresses {
    position: absolute;
    top: 0px;
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 953px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 954px) {
  body {
    padding-right: 380px;
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">PP architecture</td>
<td class="right">March 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Davidson</td>
<td class="center">Expires 17 September 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-davidson-pp-architecture-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-03-16" class="published">16 March 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-09-17">17 September 2020</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Davidson</div>
<div class="org">Cloudflare Portugal</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Privacy Pass: Architectural Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies the architectural framework for constructing
secure and privacy-preserving instantiations of the Privacy Pass
protocol (as described in <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>). The framework
refers to the entire ecosystem of Privacy Pass clients and servers. This
document makes recommendations on how this ecosystem should be
constructed to ensure the privacy of clients and the security of all
participating entities.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 17 September 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-layout" class="xref">Layout</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-architectural-ecosystem-ass" class="xref">Architectural ecosystem assumptions</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-servers" class="xref">Servers</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="xref">2.1.1</a>.  <a href="#name-long-term-signing" class="xref">Long-term signing</a><a href="#section-toc.1-1.2.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-clients" class="xref">Clients</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-global-configuration-store" class="xref">Global configuration store</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-protocol-integration-policy" class="xref">Protocol integration policy</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-recap-protocol-api" class="xref">Recap: Protocol API</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-server-interfaces" class="xref">Server interfaces</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-server_key_gen" class="xref">SERVER_KEY_GEN</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-server_store_config" class="xref">SERVER_STORE_CONFIG</a><a href="#section-toc.1-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="xref">3.2.3</a>.  <a href="#name-server_config_retrieval" class="xref">SERVER_CONFIG_RETRIEVAL</a><a href="#section-toc.1-1.3.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="xref">3.2.4</a>.  <a href="#name-server_hello" class="xref">SERVER_HELLO</a><a href="#section-toc.1-1.3.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="xref">3.2.5</a>.  <a href="#name-server_issue" class="xref">SERVER_ISSUE</a><a href="#section-toc.1-1.3.2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.6">
                    <p id="section-toc.1-1.3.2.2.2.6.1"><a href="#section-3.2.6" class="xref">3.2.6</a>.  <a href="#name-server_redeem" class="xref">SERVER_REDEEM</a><a href="#section-toc.1-1.3.2.2.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.7">
                    <p id="section-toc.1-1.3.2.2.2.7.1"><a href="#section-3.2.7" class="xref">3.2.7</a>.  <a href="#name-server_double_spend_check" class="xref">SERVER_DOUBLE_SPEND_CHECK</a><a href="#section-toc.1-1.3.2.2.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2.2.8">
                    <p id="section-toc.1-1.3.2.2.2.8.1"><a href="#section-3.2.8" class="xref">3.2.8</a>.  <a href="#name-server_double_spend_store" class="xref">SERVER_DOUBLE_SPEND_STORE</a><a href="#section-toc.1-1.3.2.2.2.8.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-client-interfaces" class="xref">Client interfaces</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-client_config_retrieval" class="xref">CLIENT_CONFIG_RETRIEVAL</a><a href="#section-toc.1-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-client_issue_gen" class="xref">CLIENT_ISSUE_GEN</a><a href="#section-toc.1-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="xref">3.3.3</a>.  <a href="#name-client_issue_finish" class="xref">CLIENT_ISSUE_FINISH</a><a href="#section-toc.1-1.3.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.4">
                    <p id="section-toc.1-1.3.2.3.2.4.1"><a href="#section-3.3.4" class="xref">3.3.4</a>.  <a href="#name-client_redeem" class="xref">CLIENT_REDEEM</a><a href="#section-toc.1-1.3.2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.5">
                    <p id="section-toc.1-1.3.2.3.2.5.1"><a href="#section-3.3.5" class="xref">3.3.5</a>.  <a href="#name-client_issue_storage" class="xref">CLIENT_ISSUE_STORAGE</a><a href="#section-toc.1-1.3.2.3.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.6">
                    <p id="section-toc.1-1.3.2.3.2.6.1"><a href="#section-3.3.6" class="xref">3.3.6</a>.  <a href="#name-client_issue_retrieval" class="xref">CLIENT_ISSUE_RETRIEVAL</a><a href="#section-toc.1-1.3.2.3.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.7">
                    <p id="section-toc.1-1.3.2.3.2.7.1"><a href="#section-3.3.7" class="xref">3.3.7</a>.  <a href="#name-client_token_storage" class="xref">CLIENT_TOKEN_STORAGE</a><a href="#section-toc.1-1.3.2.3.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.8">
                    <p id="section-toc.1-1.3.2.3.2.8.1"><a href="#section-3.3.8" class="xref">3.3.8</a>.  <a href="#name-client_token_retrieval" class="xref">CLIENT_TOKEN_RETRIEVAL</a><a href="#section-toc.1-1.3.2.3.2.8.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-global-configuration-regist" class="xref">Global configuration registry interfaces</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a href="#section-3.4.1" class="xref">3.4.1</a>.  <a href="#name-global_config_update" class="xref">GLOBAL_CONFIG_UPDATE</a><a href="#section-toc.1-1.3.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a href="#section-3.4.2" class="xref">3.4.2</a>.  <a href="#name-global_config_retrieval" class="xref">GLOBAL_CONFIG_RETRIEVAL</a><a href="#section-toc.1-1.3.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-key-management-framework" class="xref">Key management framework</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-global-configuration" class="xref">Global configuration</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-configuration-structure" class="xref">Configuration structure</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-configuration-updates-confi" class="xref">Configuration updates #{config-update}</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-client-retrieval" class="xref">Client retrieval</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-key-revocation" class="xref">Key revocation</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-server-running-modes" class="xref">Server running modes</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-single-issuer-single-verifi" class="xref">Single-Issuer Single-Verifier</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-single-issuer-forwarding-ve" class="xref">Single-Issuer Forwarding-Verifier</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-single-issue-asynchronous-v" class="xref">Single-Issue Asynchronous-Verifier</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-bounded-issuers" class="xref">Bounded-Issuers</a><a href="#section-toc.1-1.5.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-privacy-analysis" class="xref">Privacy analysis</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-user-segregation" class="xref">User segregation</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="xref">6.1.1</a>.  <a href="#name-server-configuration-rotati" class="xref">Server configuration rotation</a><a href="#section-toc.1-1.6.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="xref">6.1.2</a>.  <a href="#name-large-numbers-of-issuers" class="xref">Large numbers of issuers</a><a href="#section-toc.1-1.6.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-tracking-and-identity-leaka" class="xref">Tracking and identity leakage</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-client-incentives-for-anony" class="xref">Client incentives for anonymity reduction</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-double-spend-protection" class="xref">Double-spend protection</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-configuration-rotation" class="xref">Configuration rotation</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-token-exhaustion" class="xref">Token exhaustion</a><a href="#section-toc.1-1.7.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-protocol-parametrization" class="xref">Protocol parametrization</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-justification" class="xref">Justification</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-example-parameterization" class="xref">Example parameterization</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-recommendations-for-identif" class="xref">Recommendations for identifying malicious behavior</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-extension-integration-polic" class="xref">Extension integration policy</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-existing-applications" class="xref">Existing applications</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-cloudflare-challenge-pages" class="xref">Cloudflare challenge pages</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-trust-token-api" class="xref">Trust Token API</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="xref">11.3</a>.  <a href="#name-zero-knowledge-access-passe" class="xref">Zero-knowledge Access Passes</a><a href="#section-toc.1-1.11.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-11.4" class="xref">11.4</a>.  <a href="#name-basic-attention-tokens" class="xref">Basic Attention Tokens</a><a href="#section-toc.1-1.11.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#section-11.5" class="xref">11.5</a>.  <a href="#name-token-based-services" class="xref">Token Based Services</a><a href="#section-toc.1-1.11.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.12.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.12.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-message-formats" class="xref">Message formats</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-a.1" class="xref">A.1</a>.  <a href="#name-server-messages" class="xref">Server messages</a><a href="#section-toc.1-1.13.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1.2.1">
                    <p id="section-toc.1-1.13.2.1.2.1.1"><a href="#section-a.1.1" class="xref">A.1.1</a>.  <a href="#name-server_config_store" class="xref">server_config_store</a><a href="#section-toc.1-1.13.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1.2.2">
                    <p id="section-toc.1-1.13.2.1.2.2.1"><a href="#section-a.1.2" class="xref">A.1.2</a>.  <a href="#name-server_config_retrieve" class="xref">server_config_retrieve</a><a href="#section-toc.1-1.13.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1.2.3">
                    <p id="section-toc.1-1.13.2.1.2.3.1"><a href="#section-a.1.3" class="xref">A.1.3</a>.  <a href="#name-server_hello-2" class="xref">server_hello</a><a href="#section-toc.1-1.13.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1.2.4">
                    <p id="section-toc.1-1.13.2.1.2.4.1"><a href="#section-a.1.4" class="xref">A.1.4</a>.  <a href="#name-server_issue_resp" class="xref">server_issue_resp</a><a href="#section-toc.1-1.13.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1.2.5">
                    <p id="section-toc.1-1.13.2.1.2.5.1"><a href="#section-a.1.5" class="xref">A.1.5</a>.  <a href="#name-server_redeem_resp" class="xref">server_redeem_resp</a><a href="#section-toc.1-1.13.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-a.2" class="xref">A.2</a>.  <a href="#name-client-message-formats" class="xref">Client message formats</a><a href="#section-toc.1-1.13.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.1">
                    <p id="section-toc.1-1.13.2.2.2.1.1"><a href="#section-a.2.1" class="xref">A.2.1</a>.  <a href="#name-client_issue_generation" class="xref">client_issue_generation</a><a href="#section-toc.1-1.13.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.2">
                    <p id="section-toc.1-1.13.2.2.2.2.1"><a href="#section-a.2.2" class="xref">A.2.2</a>.  <a href="#name-client_issue_storage-2" class="xref">client_issue_storage</a><a href="#section-toc.1-1.13.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.3">
                    <p id="section-toc.1-1.13.2.2.2.3.1"><a href="#section-a.2.3" class="xref">A.2.3</a>.  <a href="#name-client_issue" class="xref">client_issue</a><a href="#section-toc.1-1.13.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.4">
                    <p id="section-toc.1-1.13.2.2.2.4.1"><a href="#section-a.2.4" class="xref">A.2.4</a>.  <a href="#name-client_issue_retrieval-2" class="xref">client_issue_retrieval</a><a href="#section-toc.1-1.13.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.5">
                    <p id="section-toc.1-1.13.2.2.2.5.1"><a href="#section-a.2.5" class="xref">A.2.5</a>.  <a href="#name-client_issue_retrieval_resp" class="xref">client_issue_retrieval_resp</a><a href="#section-toc.1-1.13.2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.6">
                    <p id="section-toc.1-1.13.2.2.2.6.1"><a href="#section-a.2.6" class="xref">A.2.6</a>.  <a href="#name-client_token_storage-2" class="xref">client_token_storage</a><a href="#section-toc.1-1.13.2.2.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.7">
                    <p id="section-toc.1-1.13.2.2.2.7.1"><a href="#section-a.2.7" class="xref">A.2.7</a>.  <a href="#name-client_token_retrieval-2" class="xref">client_token_retrieval</a><a href="#section-toc.1-1.13.2.2.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.8">
                    <p id="section-toc.1-1.13.2.2.2.8.1"><a href="#section-a.2.8" class="xref">A.2.8</a>.  <a href="#name-client_token_retrieval_resp" class="xref">client_token_retrieval_resp</a><a href="#section-toc.1-1.13.2.2.2.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.9">
                    <p id="section-toc.1-1.13.2.2.2.9.1"><a href="#section-a.2.9" class="xref">A.2.9</a>.  <a href="#name-client_redeem_generation" class="xref">client_redeem_generation</a><a href="#section-toc.1-1.13.2.2.2.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2.2.10">
                    <p id="section-toc.1-1.13.2.2.2.10.1"><a href="#section-a.2.10" class="xref">A.2.10</a>. <a href="#name-client_redeem-2" class="xref">client_redeem</a><a href="#section-toc.1-1.13.2.2.2.10.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-a.3" class="xref">A.3</a>.  <a href="#name-global-configuration-interf" class="xref">Global configuration interfaces</a><a href="#section-toc.1-1.13.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.3.2.1">
                    <p id="section-toc.1-1.13.2.3.2.1.1"><a href="#section-a.3.1" class="xref">A.3.1</a>.  <a href="#name-config_update" class="xref">config_update</a><a href="#section-toc.1-1.13.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.3.2.2">
                    <p id="section-toc.1-1.13.2.3.2.2.1"><a href="#section-a.3.2" class="xref">A.3.2</a>.  <a href="#name-config_retrieval" class="xref">config_retrieval</a><a href="#section-toc.1-1.13.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.3.2.3">
                    <p id="section-toc.1-1.13.2.3.2.3.1"><a href="#section-a.3.3" class="xref">A.3.3</a>.  <a href="#name-config_retrieval_resp" class="xref">config_retrieval_resp</a><a href="#section-toc.1-1.13.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Privacy Pass protocol provides a privacy-preserving mechanism for
authorization of clients with servers. The protocol is detailed in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span> and is intended for use in
performance-critical settings, such as while browsing the Internet.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The way that the ecosystem around the protocol is set up can have
significant impacts on the stated privacy and security guarantees of the
protocol. For instance, the number of servers issuing Privacy Pass
tokens, along with the number of registered clients, determines the
privacy budget available to each individual client. This can be further
influenced by other factors, such as: the key rotation policy used by
each server; and, the number of supported ciphersuites. There are also
client-behavior patterns that can reduce the effective security of the
server.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In this document, we will provide a structural framework for building
the ecosystem around the Privacy Pass protocol. Firstly, it will
identify a number of common interfaces for integrating the Privacy Pass
protocol and the API detailed in <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>. The API
in the protocol document represents a basic one-on-one exchange between
a client and a server. The interfaces that we describe in this document
reproduce this API into the setting where clients and servers are part
of a wider ecosystem.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">On top of this, the document also includes policies for the following
considerations:<a href="#section-1-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-1-5.1">How server configurations and key material should be stored and
rotated in an open and transparent manner.<a href="#section-1-5.1" class="pilcrow">¶</a>
</li>
<li id="section-1-5.2">Compatible server issuance and redemption running modes and associated
expectations.<a href="#section-1-5.2" class="pilcrow">¶</a>
</li>
<li id="section-1-5.3">A concrete assessment and parametrization of the privacy budget
associated with different settings of the above policies.<a href="#section-1-5.3" class="pilcrow">¶</a>
</li>
<li id="section-1-5.4">Recommendations for identifying malicious server behavior.<a href="#section-1-5.4" class="pilcrow">¶</a>
</li>
<li id="section-1-5.5">Assessment of client incentives for eschewing privacy features.<a href="#section-1-5.5" class="pilcrow">¶</a>
</li>
<li id="section-1-5.6">The incorporation of potential extensions into the wider ecosystem.<a href="#section-1-5.6" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-1-6">Finally, we will discuss existing applications that make use of the
Privacy Pass protocol, and highlight how these may fit with the proposed
framework.<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The following terms are used throughout this document.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-1.1-3.1">Server: A service that provides access to a certain resource
(typically denoted S)<a href="#section-1.1-3.1" class="pilcrow">¶</a>
</li>
<li id="section-1.1-3.2">Client: An entity that seeks authorization from a server (typically
denoted C)<a href="#section-1.1-3.2" class="pilcrow">¶</a>
</li>
<li id="section-1.1-3.3">Key: Server's secret key<a href="#section-1.1-3.3" class="pilcrow">¶</a>
</li>
<li id="section-1.1-3.4">Config: The server configuration associated with the key material and
ciphersuite choices that it makes.<a href="#section-1.1-3.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-1.1-4">We assume that all protocol messages are encoded into raw byte format
before being sent. We use the TLS presentation language <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> to
describe the structure of the data that is communicated and stored.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="layout">
<section id="section-1.2">
        <h3 id="name-layout">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-layout" class="section-name selfRef">Layout</a>
        </h3>
<ul>
<li id="section-1.2-1.1">
            <a href="#ecosystem" class="xref">Section 2</a>: Describes the basic assumptions that we make in this
document on the shape and topology of the Privacy Pass ecosystem: the
environment in which Privacy Pass supporting clients and servers
interact with each other.<a href="#section-1.2-1.1" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.2">
            <a href="#integration" class="xref">Section 3</a>: Describes the policy and framework for building
interoperable client and server implementations. Also provides the
necessary foundations for interacting with the global configuration
registry.<a href="#section-1.2-1.2" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.3">
            <a href="#key-mgmt" class="xref">Section 4</a>: Describes the structure of server key configurations and
how this configuration is retrieved and updated.<a href="#section-1.2-1.3" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.4">
            <a href="#running-modes" class="xref">Section 5</a>: Describes the different running modes that are
currently expected from Privacy Pass servers.<a href="#section-1.2-1.4" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.5">
            <a href="#privacy" class="xref">Section 6</a>: An analysis of the characteristics of the Privacy Pass
architecture that have an impact on the privacy of clients
participating in the ecosystem.<a href="#section-1.2-1.5" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.6">
            <a href="#security" class="xref">Section 7</a>: An analysis of the security characteristics of the
protocol when viewed as a part of the wider architecture of the
protocol ecosystem. Includes discussions of the cases for both servers
and clients.<a href="#section-1.2-1.6" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.7">
            <a href="#parametrization" class="xref">Section 8</a>: Provides an example parametrization of the
privacy and security parameters that are associated with the protocol,
based on the previous discussions.<a href="#section-1.2-1.7" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.8">
            <a href="#recs-srvr" class="xref">Section 9</a>: Recommendations for identifying and highlighting
potential malicious behavior by a server.<a href="#section-1.2-1.8" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.9">
            <a href="#extensions" class="xref">Section 10</a>: Describes the policy for writing extensions to the
Privacy Pass protocol, and how they may be incorporated into the wider
architecture.<a href="#section-1.2-1.9" class="pilcrow">¶</a>
</li>
<li id="section-1.2-1.10">
            <a href="#applications" class="xref">Section 11</a>: A non-exhaustive list of the applications that make
use of the Privacy Pass protocol, or some variant of it.<a href="#section-1.2-1.10" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="ecosystem">
<section id="section-2">
      <h2 id="name-architectural-ecosystem-ass">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-architectural-ecosystem-ass" class="section-name selfRef">Architectural ecosystem assumptions</a>
      </h2>
<p id="section-2-1">The Privacy Pass ecosystem refers to the global framework in which
multiple instances of the Privacy Pass protocol operate. This refers to
all servers that support the protocol, or any extension of it, along
with all of the clients that may interact with these servers. Moreover,
there is a singular public entity known as the 'global configuration
registry'. This registry presents the public information related to all
supported server key material. This is required to enable the client to
process issuance responses from each of the available servers.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The ecosystem itself, and the way it is constructed, is critical for
evaluating the privacy of each individual client. We assume that a
client's privacy refers to fraction of users that it represents in the
anonymity set that it belongs to. We discuss this more in <a href="#privacy" class="xref">Section 6</a>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="ecosystem-servers">
<section id="section-2.1">
        <h3 id="name-servers">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-servers" class="section-name selfRef">Servers</a>
        </h3>
<p id="section-2.1-1">Servers in the Privacy Pass ecosystem are entities whose primary
function is to undertake the role of the <code>Server</code> in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>. To facilitate this, the server must hold
the following data at any given time:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-2.1-2.1">a valid server configuration (<code>ServerConfig</code>) as specified in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>;<a href="#section-2.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-2.1-2.2">a long-term signing key pair for a signature scheme <code>sig_alg</code>;<a href="#section-2.1-2.2" class="pilcrow">¶</a>
</li>
<li id="section-2.1-2.3">storage of Privacy Pass tokens that have been previously redeemed with
the server.<a href="#section-2.1-2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-2.1-3">The server must be available at a specified address (uniquely identified
by <code>server_id</code>) that accepts communications from Privacy Pass clients
<a href="#ecosystem-clients" class="xref">Section 2.2</a> on the interfaces defined in
<a href="#server-interfaces" class="xref">Section 3.2</a>. When the server wants to update its
configuration, it communicates with the global configuration registry
<a href="#ecosystem-config" class="xref">Section 2.3</a>.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<div id="long-term-signing">
<section id="section-2.1.1">
          <h4 id="name-long-term-signing">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-long-term-signing" class="section-name selfRef">Long-term signing</a>
          </h4>
<p id="section-2.1.1-1">The long-term signing key pair <code>(k_sign, k_vrfy)</code> is used to sign
configuration data that is sent to the global configuration registry.
The server must prove to the global key configuration registry the
veracity of the long-term key-pair that it uses. This key pair is
attached to the configuration that it maintains. We assume the following
functional API:<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-2.1.1-2.1">
              <code>sig = sig_alg.sign(k_sign, data)</code>: produces a signature <code>sig</code> using
the signing key, <code>k_sign</code>, over the bytes of <code>data</code>.<a href="#section-2.1.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-2.1.1-2.2">
              <code>b = sig_alg.verify(k_vrfy, data, sig)</code>: produces a boolean result <code>b</code>
indicating that <code>sig</code> is a valid signature over <code>data</code> using the
signing key <code>k_sign</code>.<a href="#section-2.1.1-2.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-2.1.1-3">As per usual, we assume that any signature produced by the <code>.sign</code>
function produces a result of <code>true</code> when verifying using <code>.verify</code>.
Likewise, the scheme should also satisfy the well-known security
property of existential unforgeability. Valid instantiations include DSA
(and ECDSA) <span>[<a href="#X9.62" class="xref">X9.62</a>]</span>.<a href="#section-2.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ecosystem-clients">
<section id="section-2.2">
        <h3 id="name-clients">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-clients" class="section-name selfRef">Clients</a>
        </h3>
<p id="section-2.2-1">Clients in the Privacy Pass ecosystem are entities whose primary
function is to undertake the role of the <code>Client</code> in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>. The clients are assumed to only store
data related to the tokens that it has been issued by the server. This
storage is used for constructing redemption requests, see the
<code>CLIENT_REDEEM</code> interface (<a href="#interface-cli-redeem" class="xref">Section 3.3.4</a>) for more details.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">The clients must also have access to the global config store
<a href="#ecosystem-config" class="xref">Section 2.3</a>. This is so that the client can retrieve data
related to the configuration of the server that it is communicating
with.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">Each client must be addressed by a unique identifier, given by
<code>client_id</code>.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ecosystem-config">
<section id="section-2.3">
        <h3 id="name-global-configuration-store">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-global-configuration-store" class="section-name selfRef">Global configuration store</a>
        </h3>
<p id="section-2.3-1">The global configuration store controls all the configuration data that
is used by the servers that are part of the Privacy Pass ecosystem. This
data is required to allow clients to verify server issuance responses.
The server configuration data corresponds to all the ciphersuites and
key fingerprints that have ever been used, by every server in the
Privacy Pass ecosystem.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">The config store is an append-only database that supports revocation of
old configurations. This is done by limiting the number of active
configurations that a server can use at any given time. It should be
available at a publicly-broadcasted address so that both clients and
servers can access it. The database should preserve its history in an
audit-friendly manner.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">The way that the config store is implemented can have a dramatic effect
on the privacy of the clients in the Privacy Pass protocol. We describe
in detail how such a store should be implemented in <a href="#key-mgmt" class="xref">Section 4</a>.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="integration">
<section id="section-3">
      <h2 id="name-protocol-integration-policy">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-integration-policy" class="section-name selfRef">Protocol integration policy</a>
      </h2>
<p id="section-3-1">We provide a number of common interfaces that both the clients and
servers implement. These interfaces should be contactable by entities in
the ecosystem, and provide a framework for generating and processing
data in the Privacy Pass protocol. The framework provides a policy that
states that these interfaces be implemented (for example, by clients and
servers) to be considered valid entities in the Privacy Pass ecosystem.
The interfaces wrap the Privacy Pass API functions detailed in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span> to provide functionality in the many-many
ecosystem consisting of clients and servers.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The interfaces have three configurable fields. The <code>Visibility</code> field
indicates that the interface is either contactable externally
(<code>external</code>) or that it is activated internally by the entity at some
point (<code>internal</code>). The <code>Input</code> field determines valid input types of
that are received by the interface. The <code>Returns</code> field provides the
return type of the function. The <code>Steps</code> field notes high-level steps to
be taken when the interface is contacted.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">Note: currently we live the implementation of errors up to the
implementer. By default, if any internal Privacy Pass protocol function
(<a href="#recap-pp-protocol" class="xref">Section 3.1</a>) throws an error, then the interface should
panic. More fine-grained error reporting may be added in future versions
of this draft.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="recap-pp-protocol">
<section id="section-3.1">
        <h3 id="name-recap-protocol-api">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-recap-protocol-api" class="section-name selfRef">Recap: Protocol API</a>
        </h3>
<p id="section-3.1-1">The protocol document <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span> specifically
details a number of public API functions that are used for constructing
the generic protocol. These functions can be split into server and
client functionality.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.1-2">
          <li id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">Server functionality:<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-3.1-2.1.2.1">
                <code>PP_Server_Setup</code>: Generates server configuration and keys<a href="#section-3.1-2.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.1-2.1.2.2">
                <code>PP_Issue</code>: Run on the contents of the client message in the
issuance phase.<a href="#section-3.1-2.1.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.1-2.1.2.3">
                <code>PP_Verify</code>: Run on the contents of the client message in the
redemption phase.<a href="#section-3.1-2.1.2.3" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">Client functionality:<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-3.1-2.2.2.1">
                <code>PP_Client_Setup</code>: Generates the client configuration based on the
configuration used by a given server.<a href="#section-3.1-2.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.1-2.2.2.2">
                <code>PP_Generate</code>: Generates public and private data associated with
the contents of the client message in the issuance phase.<a href="#section-3.1-2.2.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.1-2.2.2.3">
                <code>PP_Process</code>: Processes the contents of the server response in the
issuance phase.<a href="#section-3.1-2.2.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.1-2.2.2.4">
                <code>PP_Redeem</code>: Generates the data that forms the client message in
the redemption phase.<a href="#section-3.1-2.2.2.4" class="pilcrow">¶</a>
</li>
</ul>
</li>
</ol>
<p id="section-3.1-3">We will use each of the functions internally in the description of the
interfaces that follows.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-interfaces">
<section id="section-3.2">
        <h3 id="name-server-interfaces">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-server-interfaces" class="section-name selfRef">Server interfaces</a>
        </h3>
<p id="section-3.2-1">Any implementation of a Privacy Pass Server MUST implement the following
contact points or interfaces. When the Server is contacted on these
interfaces with the required input data, it should take the steps
detailed. The inputs and responses for each of the interfaces correspond
to the data structures defined in <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="interface-key-gen">
<section id="section-3.2.1">
          <h4 id="name-server_key_gen">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-server_key_gen" class="section-name selfRef">SERVER_KEY_GEN</a>
          </h4>
<ul>
<li id="section-3.2.1-1.1">Visibility: <code>internal</code><a href="#section-3.2.1-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.2">Input: a string, <code>id</code>, corresponding to a ciphersuite identifier (see
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span> for valid configurations).<a href="#section-3.2.1-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.3">Returns: a boolean <code>b</code>, indicating success.<a href="#section-3.2.1-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4">
              <p id="section-3.2.1-1.4.1">Steps:<a href="#section-3.2.1-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.1-1.4.2">
                <li id="section-3.2.1-1.4.2.1">Run <code>(cfg, update) = PP_Server_Setup(id)</code>.<a href="#section-3.2.1-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.2">Construct a <code>config_update</code> message.<a href="#section-3.2.1-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.3">The value <code>&lt;server_id&gt;</code> is the unique identifier for the Server.<a href="#section-3.2.1-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.4">The value of <code>&lt;expiry_time&gt;</code> should be a point in the future
within the window of allowed key rotation lengths (for example,
those specified in <a href="#parametrization" class="xref">Section 8</a>).<a href="#section-3.2.1-1.4.2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.5">The value <code>&lt;comm_id&gt;</code> is a string used to distinguish between
config entries corresponding to the same config, but where the
key material has changed (e.g. after a key rotation).<a href="#section-3.2.1-1.4.2.5" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.6">The value of <code>&lt;supports&gt;</code> should be set to an octet
corresponding to the functionality that is provided. The value
<code>0</code> indicates that no functionality is supported; <code>1</code> indicates
that the server supports the issuance phase; <code>2</code> indicates
support for the redemption phase; and <code>3</code> indicates support for
both phases. If unspecified, this defaults to <code>3</code>.<a href="#section-3.2.1-1.4.2.6" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.7">The value of <code>&lt;config&gt;</code> is set to be equal to <code>update</code>.<a href="#section-3.2.1-1.4.2.7" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.8">
                  <p id="section-3.2.1-1.4.2.8.1">The value <code>&lt;signature&gt;</code> is computed over the bytes of the rest of
message contents, using the Server long-term secret signing key
<code>k_sign</code>. This can be computed by running:<a href="#section-3.2.1-1.4.2.8.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2.1-1.4.2.8.2">
<pre>
   data = &lt;server_id&gt; .. &lt;config&gt; .. &lt;expiry&gt; .. &lt;supports&gt;
   &lt;signature&gt; = sig_alg.sign(k_sign, data)
</pre><a href="#section-3.2.1-1.4.2.8.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.2.1-1.4.2.9">Send the <code>config_update</code> message to the <code>GLOBAL_CONFIG_UPDATE</code>
interface.<a href="#section-3.2.1-1.4.2.9" class="pilcrow">¶</a>
</li>
<li id="section-3.2.1-1.4.2.10">Send a <code>server_config_store</code> message to the <code>SERVER_STORE_CONFIG</code>
interface containing the value of <code>cfg</code>.<a href="#section-3.2.1-1.4.2.10" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-store-config">
<section id="section-3.2.2">
          <h4 id="name-server_store_config">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-server_store_config" class="section-name selfRef">SERVER_STORE_CONFIG</a>
          </h4>
<ul>
<li id="section-3.2.2-1.1">Visibility: <code>internal</code><a href="#section-3.2.2-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.2-1.2">Input: a <code>server_config_store</code> message <code>msg</code> (<a href="#msg-config-store" class="xref">Appendix A.1.1</a>).<a href="#section-3.2.2-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.2-1.3">Returns: <code>null</code><a href="#section-3.2.2-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.2-1.4">
              <p id="section-3.2.2-1.4.1">Steps:<a href="#section-3.2.2-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.2-1.4.2">
                <li id="section-3.2.2-1.4.2.1">Let <code>ex_cfg</code> correspond to the existing <code>ServerConfig</code> object keyed
by <code>issue</code>.<a href="#section-3.2.2-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.2-1.4.2.2">Store the bytes of <code>msg.config</code> in local storage, against the key
<code>issue</code>.<a href="#section-3.2.2-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.2-1.4.2.3">Store the bytes of <code>ex_cfg</code> in local storage against the key
<code>redeem</code>.<a href="#section-3.2.2-1.4.2.3" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-config-retrieval">
<section id="section-3.2.3">
          <h4 id="name-server_config_retrieval">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-server_config_retrieval" class="section-name selfRef">SERVER_CONFIG_RETRIEVAL</a>
          </h4>
<ul>
<li id="section-3.2.3-1.1">Visibility: <code>internal</code><a href="#section-3.2.3-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.2">Input: an octet <code>method</code> in <code>{1,2,3}</code>.<a href="#section-3.2.3-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.3">Returns: A <code>server_config_retrieve</code> message <code>resp</code>
(<a href="#msg-config-retrieve" class="xref">Appendix A.1.2</a>).<a href="#section-3.2.3-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.4">
              <p id="section-3.2.3-1.4.1">Steps:<a href="#section-3.2.3-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.3-1.4.2">
                <li id="section-3.2.3-1.4.2.1">Let <code>storage</code> be the ID and the bytes of the server config
currently stored in local storage, respectively.<a href="#section-3.2.3-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.4.2.2">If <code>resp.config.supports != method &amp;&amp; resp.config.supports != 3</code>,
then return <code>null</code>.<a href="#section-3.2.3-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.4.2.3">Let <code>resp</code> be a <code>server_config_retrieve</code> message, where
<code>&lt;configs&gt;=[config]</code> for <code>config</code> stored in local storage against
<code>issue</code>.<a href="#section-3.2.3-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.4.2.4">If <code>method == 2</code>, append <code>ex_config</code> to <code>&lt;configs&gt;</code>, where
<code>ex_config</code> is stored in local storage against the key <code>redeem</code>.<a href="#section-3.2.3-1.4.2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.2.3-1.4.2.5">Return <code>resp</code>.<a href="#section-3.2.3-1.4.2.5" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-hello">
<section id="section-3.2.4">
          <h4 id="name-server_hello">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-server_hello" class="section-name selfRef">SERVER_HELLO</a>
          </h4>
<ul>
<li id="section-3.2.4-1.1">Visibility: <code>external</code><a href="#section-3.2.4-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.4-1.2">Input: a string, <code>client_addr</code>, corresponding to an address that the
client can be contacted on.<a href="#section-3.2.4-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.4-1.3">Return: <code>null</code><a href="#section-3.2.4-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.4-1.4">
              <p id="section-3.2.4-1.4.1">Steps:<a href="#section-3.2.4-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.4-1.4.2">
                <li id="section-3.2.4-1.4.2.1">Send an empty message to the internal <code>SERVER_CONFIG_RETRIEVAL</code>
interface, and let <code>cfgs=resp.configs</code> based on the
<code>server_config_retrieve</code> response <code>resp</code>.<a href="#section-3.2.4-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.4-1.4.2.2">
                  <p id="section-3.2.4-1.4.2.2.1">Send a <code>server_hello</code> message to the <code>CLIENT_CONFIG_RETRIEVAL</code>
interface for the client at <code>client_addr</code>. The <code>server_hello</code>
message must satisfy the following:<a href="#section-3.2.4-1.4.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.4-1.4.2.2.2">
                    <li id="section-3.2.4-1.4.2.2.2.1">The value <code>&lt;server_id&gt;=server_id</code> is the unique identifier for
the Server.<a href="#section-3.2.4-1.4.2.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.4-1.4.2.2.2.2">The value of <code>&lt;supports&gt;</code> MUST be set to an octet corresponding
to the supported methods.<a href="#section-3.2.4-1.4.2.2.2.2" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-issue">
<section id="section-3.2.5">
          <h4 id="name-server_issue">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-server_issue" class="section-name selfRef">SERVER_ISSUE</a>
          </h4>
<ul>
<li id="section-3.2.5-1.1">Visibility: <code>external</code><a href="#section-3.2.5-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.5-1.2">Input: A <code>client_issue</code> message <code>msg</code> (<a href="#msg-client-issue" class="xref">Appendix A.2.3</a>)<a href="#section-3.2.5-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.5-1.3">Returns: A <code>server_issue_resp</code> message<a href="#section-3.2.5-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.5-1.4">
              <p id="section-3.2.5-1.4.1">Steps:<a href="#section-3.2.5-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.5-1.4.2">
                <li id="section-3.2.5-1.4.2.1">Send the message <code>issue</code> to the internal
<code>SERVER_CONFIG_RETRIEVAL</code> interface, and let
<code>ciphersuite=msg.ciphersuites[0]</code> and <code>srv_cfg=msg.configs[0]</code>
based on the <code>server_config_retrieve</code> response.<a href="#section-3.2.5-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.5-1.4.2.2">
                  <p id="section-3.2.5-1.4.2.2.1">Run the following:<a href="#section-3.2.5-1.4.2.2.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2.5-1.4.2.2.2">
<pre>
   issue_resp = PP_Issue(srv_cfg, msg.issue_data)
</pre><a href="#section-3.2.5-1.4.2.2.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.2.5-1.4.2.3">Returns a <code>server_issue_resp</code> message with <code>&lt;data&gt;=issue_resp</code>
message back to the caller <code>CLIENT_ISSUE_GEN</code> interface of the
client associated with <code>client_issue.client_id</code>.<a href="#section-3.2.5-1.4.2.3" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-redeem">
<section id="section-3.2.6">
          <h4 id="name-server_redeem">
<a href="#section-3.2.6" class="section-number selfRef">3.2.6. </a><a href="#name-server_redeem" class="section-name selfRef">SERVER_REDEEM</a>
          </h4>
<ul>
<li id="section-3.2.6-1.1">Visibility: <code>external</code><a href="#section-3.2.6-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.2">Input: A <code>client_redeem</code> message <code>msg</code> (<a href="#msg-client-redeem" class="xref">Appendix A.2.10</a>)<a href="#section-3.2.6-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.3">Returns: A <code>server_redeem_resp</code> message back to the calling
<code>CLIENT_REDEEM</code> interface (<a href="#msg-server-redeem-resp" class="xref">Appendix A.1.5</a>).<a href="#section-3.2.6-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.4">
              <p id="section-3.2.6-1.4.1">Steps:<a href="#section-3.2.6-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.6-1.4.2">
                <li id="section-3.2.6-1.4.2.1">Send the message <code>redeem</code> to the internal
<code>SERVER_CONFIG_RETRIEVAL</code> interface, let <code>configs</code>
be the returned array.<a href="#section-3.2.6-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.4.2.2">Send <code>msg.message.data</code> to the <code>SERVER_DOUBLE_SPEND_CHECK</code>
interface and, if the response is <code>true</code>, return an unsuccessful
<code>server_redeem_resp</code> message to the client.<a href="#section-3.2.6-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.4.2.3">
                  <p id="section-3.2.6-1.4.2.3.1">Run the following:<a href="#section-3.2.6-1.4.2.3.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2.6-1.4.2.3.2">
<pre>
   resp = PP_Verify(configs[0],message)
   if (!resp.success) {
     resp = PP_Verify(configs[1],message)
   }
</pre><a href="#section-3.2.6-1.4.2.3.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.2.6-1.4.2.4">Send <code>msg.message.data</code> to the <code>SERVER_DOUBLE_SPEND_STORE</code>
interface.<a href="#section-3.2.6-1.4.2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.2.6-1.4.2.5">The Server returns a <code>server_redeem_resp</code> message, with
<code>&lt;data&gt;=resp</code> back to the <code>CLIENT_REDEEM</code> interface of the client
associated with <code>client_redeem.client_id</code>.<a href="#section-3.2.6-1.4.2.5" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-spend-check">
<section id="section-3.2.7">
          <h4 id="name-server_double_spend_check">
<a href="#section-3.2.7" class="section-number selfRef">3.2.7. </a><a href="#name-server_double_spend_check" class="section-name selfRef">SERVER_DOUBLE_SPEND_CHECK</a>
          </h4>
<ul>
<li id="section-3.2.7-1.1">Visibility: <code>internal</code><a href="#section-3.2.7-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.7-1.2">Input: A byte string <code>data</code> of type <code>opaque&lt;1..2^32-1&gt;</code>
(<a href="#msg-client-redeem" class="xref">Appendix A.2.10</a>).<a href="#section-3.2.7-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.7-1.3">Returns: A boolean value <code>b</code>.<a href="#section-3.2.7-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.7-1.4">
              <p id="section-3.2.7-1.4.1">Steps:<a href="#section-3.2.7-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.7-1.4.2">
                <li id="section-3.2.7-1.4.2.1">Return <code>true</code> if <code>data</code> exists in the double-spend index, and
<code>false</code> otherwise.<a href="#section-3.2.7-1.4.2.1" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-srv-spend-store">
<section id="section-3.2.8">
          <h4 id="name-server_double_spend_store">
<a href="#section-3.2.8" class="section-number selfRef">3.2.8. </a><a href="#name-server_double_spend_store" class="section-name selfRef">SERVER_DOUBLE_SPEND_STORE</a>
          </h4>
<ul>
<li id="section-3.2.8-1.1">Visibility: <code>internal</code><a href="#section-3.2.8-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.2.8-1.2">Input: A byte string <code>data</code> of type <code>opaque&lt;1..2^32-1&gt;</code>
(<a href="#msg-client-redeem" class="xref">Appendix A.2.10</a>).<a href="#section-3.2.8-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.2.8-1.3">Returns: <code>null</code>.<a href="#section-3.2.8-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.2.8-1.4">
              <p id="section-3.2.8-1.4.1">Steps:<a href="#section-3.2.8-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.2.8-1.4.2">
                <li id="section-3.2.8-1.4.2.1">Store <code>data</code> in the double-spend index.<a href="#section-3.2.8-1.4.2.1" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="client-interfaces">
<section id="section-3.3">
        <h3 id="name-client-interfaces">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-client-interfaces" class="section-name selfRef">Client interfaces</a>
        </h3>
<p id="section-3.3-1">The following interfaces MUST be implemented for any implementation of a
Client in the Privacy Pass ecosystem (<a href="#ecosystem-clients" class="xref">Section 2.2</a>).<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="interface-cli-retrieval">
<section id="section-3.3.1">
          <h4 id="name-client_config_retrieval">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-client_config_retrieval" class="section-name selfRef">CLIENT_CONFIG_RETRIEVAL</a>
          </h4>
<ul>
<li id="section-3.3.1-1.1">Visibility: <code>external</code><a href="#section-3.3.1-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.2">Input: a <code>server_hello</code> message type denoted by <code>msg</code>,
(<a href="#msg-server-hello" class="xref">Appendix A.1.3</a>).<a href="#section-3.3.1-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.3">Return: a boolean, indicating whether the config was successfully
retrieved.<a href="#section-3.3.1-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4">
              <p id="section-3.3.1-1.4.1">Steps:<a href="#section-3.3.1-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.1-1.4.2">
                <li id="section-3.3.1-1.4.2.1">Construct a <code>config_retrieval</code> message using
<code>&lt;server_id&gt;=msg.server_id</code>.<a href="#section-3.3.1-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.2">Send the <code>config_retrieval</code> message to the
<code>GLOBAL_CONFIG_RETRIEVAL</code> interface, and receive a reply <code>resp</code> of
type <code>config_retrieval_resp</code>.<a href="#section-3.3.1-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.3">If <code>success</code> is set to <code>false</code>, return <code>false</code>.<a href="#section-3.3.1-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.4">Parse <code>resp[0].supports</code> and check that it includes support
for what is specified in <code>msg.supports</code>, otherwise return false.<a href="#section-3.3.1-1.4.2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.5">Parse <code>resp[1].supports</code> and check that it includes support
for what is specified in <code>msg.supports</code>, otherwise return false.<a href="#section-3.3.1-1.4.2.5" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.6">
                  <p id="section-3.3.1-1.4.2.6.1">The value <code>&lt;signature&gt;</code> is verified over the bytes of the rest of
message contents, using the Server long-term verification key
<code>k_vrfy</code>. This can be computed by running the function below and
checking that <code>ret==true</code>, otherwise returning false.<a href="#section-3.3.1-1.4.2.6.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.1-1.4.2.6.2">
<pre>
   data = &lt;server_id&gt; .. &lt;ciphersuite&gt; .. &lt;comm_id&gt;
           .. &lt;config&gt; .. &lt;expiry&gt; .. &lt;supports&gt;
   ret = sig_alg.verify(k_vrfy, data, &lt;signature&gt;)
</pre><a href="#section-3.3.1-1.4.2.6.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.3.1-1.4.2.7">
                  <p id="section-3.3.1-1.4.2.7.1">Construct a <code>client_token_retrieval</code> where<a href="#section-3.3.1-1.4.2.7.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.1-1.4.2.7.2">
<pre>
   ciphersuite = resp[0].ciphersuite
   comm_id = resp[0].comm_id
</pre><a href="#section-3.3.1-1.4.2.7.2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.1-1.4.2.7.3">
and send it to the <code>CLIENT_TOKEN_RETRIEVAL</code> interface. Receive back
<code>token</code> in a <code>client_token_retrieval_resp</code> message. Set
<code>config_idx=0</code>.<a href="#section-3.3.1-1.4.2.7.3" class="pilcrow">¶</a></p>
</li>
<li id="section-3.3.1-1.4.2.8">
                  <p id="section-3.3.1-1.4.2.8.1">If <code>token == null</code>, construct a <code>client_token_retrieval</code> message
where:<a href="#section-3.3.1-1.4.2.8.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.1-1.4.2.8.2">
<pre>
   ciphersuite = resp[1].ciphersuite
   comm_id = resp[1].comm_id
</pre><a href="#section-3.3.1-1.4.2.8.2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.1-1.4.2.8.3">
and send it to the <code>CLIENT_TOKEN_RETRIEVAL</code> interface. Receive back
<code>token</code> in a <code>client_token_retrieval_resp</code> message. Set
<code>config_idx=1'</code>.<a href="#section-3.3.1-1.4.2.8.3" class="pilcrow">¶</a></p>
</li>
<li id="section-3.3.1-1.4.2.9">
                  <p id="section-3.3.1-1.4.2.9.1">If:<a href="#section-3.3.1-1.4.2.9.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.1-1.4.2.9.2">
<pre>
   token == null
     &amp;&amp; (
       resp[0].supports == 1
       || resp[0].supports == 3
     )
</pre><a href="#section-3.3.1-1.4.2.9.2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.1-1.4.2.9.3">
construct a <code>client_issue_generation</code> message and send it to the
<code>CLIENT_ISSUE_GEN</code> interface, with:<a href="#section-3.3.1-1.4.2.9.3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.1-1.4.2.9.4">
                    <li id="section-3.3.1-1.4.2.9.4.1">
                      <code>&lt;server_id&gt; = msg.server_id</code>;<a href="#section-3.3.1-1.4.2.9.4.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.2.9.4.2">
                      <code>&lt;config&gt; = resp[0].config</code>;<a href="#section-3.3.1-1.4.2.9.4.2" class="pilcrow">¶</a>
</li>
</ol>
</li>
<li id="section-3.3.1-1.4.2.10">If:<a href="#section-3.3.1-1.4.2.10" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-3.3.1-1.4.3">
~~~
      token != null
        &amp;&amp; (
          resp[config_type].supports == 2
          || resp[config_type].supports == 3
        )
   ~~~<a href="#section-3.3.1-1.4.3" class="pilcrow">¶</a></p>
<p id="section-3.3.1-1.4.4">
construct a <code>client_redeem_generation</code> message and send it to the
   <code>CLIENT_REDEEM</code> interface. with:<a href="#section-3.3.1-1.4.4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.1-1.4.5">
<pre>
1. `&lt;server_id&gt; = msg.server_id`;
2. `&lt;token&gt; = token`;
</pre><a href="#section-3.3.1-1.4.5" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal" id="section-3.3.1-1.4.6">
                <li id="section-3.3.1-1.4.6.1">If neither condition in (7) or (8) is satisfied, return false.<a href="#section-3.3.1-1.4.6.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.1-1.4.6.2">Return true.<a href="#section-3.3.1-1.4.6.2" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-issue-gen">
<section id="section-3.3.2">
          <h4 id="name-client_issue_gen">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-client_issue_gen" class="section-name selfRef">CLIENT_ISSUE_GEN</a>
          </h4>
<ul>
<li id="section-3.3.2-1.1">Visibility: <code>internal</code><a href="#section-3.3.2-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.2-1.2">Input: a message <code>msg</code> of type <code>client_issue_generation</code>
(<a href="#msg-client-issue-generation" class="xref">Appendix A.2.1</a>).<a href="#section-3.3.2-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.2-1.3">Returns: <code>null</code><a href="#section-3.3.2-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.2-1.4">
              <p id="section-3.3.2-1.4.1">Steps:<a href="#section-3.3.2-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.2-1.4.2">
                <li id="section-3.3.2-1.4.2.1">
                  <p id="section-3.3.2-1.4.2.1.1">The client runs:<a href="#section-3.3.2-1.4.2.1.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-1.4.2.1.2">
<pre>
   cli_cfg = PP_Client_Setup(msg.ciphersuite, msg.config)
</pre><a href="#section-3.3.2-1.4.2.1.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.3.2-1.4.2.2">
                  <p id="section-3.3.2-1.4.2.2.1">The client runs:<a href="#section-3.3.2-1.4.2.2.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-1.4.2.2.2">
<pre>
   issue_input = PP_Generate(cli_cfg, m)
</pre><a href="#section-3.3.2-1.4.2.2.2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-1.4.2.2.3">
where <code>m</code> is an integer corresponding to the number of tokens that
should be generated.<a href="#section-3.3.2-1.4.2.2.3" class="pilcrow">¶</a></p>
</li>
<li id="section-3.3.2-1.4.2.3">The client constructs a <code>client_issue_storage</code> message and sends it
to the <code>CLIENT_ISSUE_STORAGE</code> interface, where
<code>&lt;server_id&gt;=msg.server_id</code>,
<code>&lt;client_data&gt;=issue_input.client_data</code>.<a href="#section-3.3.2-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.2-1.4.2.4">The client constructs a <code>client_issue</code> message and sends it to the
server corresponding to <code>&lt;server_id&gt;</code> with
<code>&lt;issue_data&gt;=issue_input.msg_data</code>.<a href="#section-3.3.2-1.4.2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.3.2-1.4.2.5">Receives a <code>server_issue_resp</code> message back from client_data
server, and sends this to the <code>CLIENT_ISSUE_FINISH</code> interface.<a href="#section-3.3.2-1.4.2.5" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-issue-finish">
<section id="section-3.3.3">
          <h4 id="name-client_issue_finish">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-client_issue_finish" class="section-name selfRef">CLIENT_ISSUE_FINISH</a>
          </h4>
<ul>
<li id="section-3.3.3-1.1">Visibility: <code>internal</code><a href="#section-3.3.3-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.3-1.2">Input: a message <code>msg</code> of type <code>server_issue_resp</code>
(<a href="#msg-server-issue-resp" class="xref">Appendix A.1.4</a>).<a href="#section-3.3.3-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.3-1.3">Returns: <code>null</code><a href="#section-3.3.3-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.3-1.4">
              <p id="section-3.3.3-1.4.1">Steps:<a href="#section-3.3.3-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.3-1.4.2">
                <li id="section-3.3.3-1.4.2.1">The client sends an empty message to the <code>CLIENT_ISSUE_RETRIEVAL</code>
interface and receives a <code>client_issue_retrieval</code> message <code>tmp</code> in
response.<a href="#section-3.3.3-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.3-1.4.2.2">The client sets <code>cli_cfg=tmp.config</code>.<a href="#section-3.3.3-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.3-1.4.2.3">
                  <p id="section-3.3.3-1.4.2.3.1">The client runs:<a href="#section-3.3.3-1.4.2.3.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.3-1.4.2.3.2">
<pre>
 tokens = PP_Process(cli_cfg,(msg.evals, msg.proof),tmp.g_data)
</pre><a href="#section-3.3.3-1.4.2.3.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.3.3-1.4.2.4">The client constructs a <code>client_token_storage</code> message and sends it
to the <code>CLIENT_TOKEN_STORAGE</code> interface, where <code>&lt;tokens&gt;=tokens</code>.<a href="#section-3.3.3-1.4.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-redeem">
<section id="section-3.3.4">
          <h4 id="name-client_redeem">
<a href="#section-3.3.4" class="section-number selfRef">3.3.4. </a><a href="#name-client_redeem" class="section-name selfRef">CLIENT_REDEEM</a>
          </h4>
<ul>
<li id="section-3.3.4-1.1">Visibility: <code>internal</code><a href="#section-3.3.4-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.4-1.2">Input: a message <code>msg</code> of type <code>client_redeem_generation</code>
(<a href="#msg-client-redeem-generation" class="xref">Appendix A.2.9</a>).<a href="#section-3.3.4-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.4-1.3">Returns: a boolean value <code>ret</code> indicating whether the server accepted
the redemption, or not.<a href="#section-3.3.4-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.4-1.4">
              <p id="section-3.3.4-1.4.1">Steps:<a href="#section-3.3.4-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.4-1.4.2">
                <li id="section-3.3.4-1.4.2.1">
                  <p id="section-3.3.4-1.4.2.1.1">The client runs:<a href="#section-3.3.4-1.4.2.1.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.4-1.4.2.1.2">
<pre>
   cli_cfg = PP_Client_Setup(msg.ciphersuite, msg.config)
</pre><a href="#section-3.3.4-1.4.2.1.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.3.4-1.4.2.2">
                  <p id="section-3.3.4-1.4.2.2.1">The client generates arbitrary auxiliary data <code>aux</code> and runs:<a href="#section-3.3.4-1.4.2.2.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.4-1.4.2.2.2">
<pre>
   tag = PP_Redeem(cli_cfg, msg.token, aux)
</pre><a href="#section-3.3.4-1.4.2.2.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.3.4-1.4.2.3">The client constructs a <code>client_redeem</code> message and sends it to the
<code>SERVER_REDEEM</code> interface of the Server referred to by
<code>&lt;server_id&gt;</code>, with <code>&lt;data&gt;=msg.token.data</code> and <code>&lt;aux&gt;=aux</code>.<a href="#section-3.3.4-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.4-1.4.2.4">The client returns the value boolean value indicated in the
<code>RedemptionResponse</code> received in the server's <code>server_redeem_resp</code>
message.<a href="#section-3.3.4-1.4.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-issue-storage">
<section id="section-3.3.5">
          <h4 id="name-client_issue_storage">
<a href="#section-3.3.5" class="section-number selfRef">3.3.5. </a><a href="#name-client_issue_storage" class="section-name selfRef">CLIENT_ISSUE_STORAGE</a>
          </h4>
<ul>
<li id="section-3.3.5-1.1">Visibility: <code>internal</code><a href="#section-3.3.5-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.5-1.2">Input: a <code>client_issue_storage</code> message <code>msg</code>
(<a href="#msg-client-issue-storage" class="xref">Appendix A.2.2</a>).<a href="#section-3.3.5-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.5-1.3">Returns: <code>null</code><a href="#section-3.3.5-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.5-1.4">
              <p id="section-3.3.5-1.4.1">Steps:<a href="#section-3.3.5-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.5-1.4.2">
                <li id="section-3.3.5-1.4.2.1">Stores the <code>ClientIssuanceProcessing</code> struct represented by
<code>msg.client_data</code> in local storage, keyed by <code>server_id</code>,
<code>ciphersuite</code> and <code>comm_id</code>.<a href="#section-3.3.5-1.4.2.1" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-issue-retrieval">
<section id="section-3.3.6">
          <h4 id="name-client_issue_retrieval">
<a href="#section-3.3.6" class="section-number selfRef">3.3.6. </a><a href="#name-client_issue_retrieval" class="section-name selfRef">CLIENT_ISSUE_RETRIEVAL</a>
          </h4>
<ul>
<li id="section-3.3.6-1.1">Visibility: <code>internal</code><a href="#section-3.3.6-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.6-1.2">Input: a <code>client_issue_retrieval</code> message <code>msg</code>
(<a href="#msg-client-issue-retrieval" class="xref">Appendix A.2.4</a>).<a href="#section-3.3.6-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.6-1.3">Returns: a <code>client_issue_retrieval_resp</code> message
(<a href="#msg-client-issue-retrieval-resp" class="xref">Appendix A.2.5</a>).<a href="#section-3.3.6-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.6-1.4">
              <p id="section-3.3.6-1.4.1">Steps:<a href="#section-3.3.6-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.6-1.4.2">
                <li id="section-3.3.6-1.4.2.1">Retrieve <code>client_data</code> where <code>msg.server_id</code>, <code>msg.ciphersuite</code>
and <code>msg.comm_id</code>.<a href="#section-3.3.6-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.6-1.4.2.2">Return a <code>client_issue_retrieval</code> message containing <code>client_data</code>
above to the <code>CLIENT_ISSUE_FINISH</code> interface.<a href="#section-3.3.6-1.4.2.2" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-token-storage">
<section id="section-3.3.7">
          <h4 id="name-client_token_storage">
<a href="#section-3.3.7" class="section-number selfRef">3.3.7. </a><a href="#name-client_token_storage" class="section-name selfRef">CLIENT_TOKEN_STORAGE</a>
          </h4>
<ul>
<li id="section-3.3.7-1.1">Visibility: <code>internal</code><a href="#section-3.3.7-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.7-1.2">Input: a <code>client_token_storage</code> message <code>msg</code>
(<a href="#msg-client-token-storage" class="xref">Appendix A.2.6</a>).<a href="#section-3.3.7-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.7-1.3">Returns: <code>null</code><a href="#section-3.3.7-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.7-1.4">
              <p id="section-3.3.7-1.4.1">Steps:<a href="#section-3.3.7-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.7-1.4.2">
                <li id="section-3.3.7-1.4.2.1">Stores the vector of <code>RedemptionToken</code> objects in local storage
keyed by <code>server_id</code>, <code>ciphersuite</code> and <code>comm_id</code>.<a href="#section-3.3.7-1.4.2.1" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cli-token-retrieval">
<section id="section-3.3.8">
          <h4 id="name-client_token_retrieval">
<a href="#section-3.3.8" class="section-number selfRef">3.3.8. </a><a href="#name-client_token_retrieval" class="section-name selfRef">CLIENT_TOKEN_RETRIEVAL</a>
          </h4>
<ul>
<li id="section-3.3.8-1.1">Visibility: <code>internal</code><a href="#section-3.3.8-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.2">Input: a <code>client_token_retrieval</code> message <code>msg</code>
(<a href="#msg-client-token-retrieval" class="xref">Appendix A.2.7</a>).<a href="#section-3.3.8-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.3">Returns: a <code>client_token_retrieval_resp</code> message.<a href="#section-3.3.8-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.4">
              <p id="section-3.3.8-1.4.1">Steps:<a href="#section-3.3.8-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.3.8-1.4.2">
                <li id="section-3.3.8-1.4.2.1">Retrieve all the available token <code>tokens</code> keyed by <code>msg.server_id</code>,
<code>msg.ciphersuite</code> and <code>msg.comm_id</code>.<a href="#section-3.3.8-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.4.2.2">If <code>tokens != null</code>, let <code>token = tokens.pop()</code>.<a href="#section-3.3.8-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.4.2.3">Store the modified <code>tokens</code> object back in local storage by
interacting with the <code>CLIENT_TOKEN_STORAGE</code> interface.<a href="#section-3.3.8-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.3.8-1.4.2.4">Return a <code>client_token_retrieval</code> message containing the token
value above (or <code>null</code> if <code>tokens == null</code>) to the
<code>CLIENT_CONFIG_RETRIEVAL</code> interface.<a href="#section-3.3.8-1.4.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="config-interfaces">
<section id="section-3.4">
        <h3 id="name-global-configuration-regist">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-global-configuration-regist" class="section-name selfRef">Global configuration registry interfaces</a>
        </h3>
<div id="interface-cfg-update">
<section id="section-3.4.1">
          <h4 id="name-global_config_update">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-global_config_update" class="section-name selfRef">GLOBAL_CONFIG_UPDATE</a>
          </h4>
<ul>
<li id="section-3.4.1-1.1">Visibility: <code>external</code><a href="#section-3.4.1-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.4.1-1.2">Input: a <code>config_update</code> message <code>msg</code> (<a href="#msg-config-update" class="xref">Appendix A.3.1</a>).<a href="#section-3.4.1-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.4.1-1.3">Returns: <code>null</code><a href="#section-3.4.1-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.4.1-1.4">
              <p id="section-3.4.1-1.4.1">Steps:<a href="#section-3.4.1-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.4.1-1.4.2">
                <li id="section-3.4.1-1.4.2.1">
                  <p id="section-3.4.1-1.4.2.1.1">Creates an entry in the global config registry, keyed by
<code>msg.server_id</code>, <code>msg.config.ciphersuite</code> and <code>msg.comm_id</code>.
Therefore, the registry data block takes the form:<a href="#section-3.4.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.1-1.4.2.1.2">
<pre>
   server_id: msg.server_id
     ciphersuite: msg.config.ciphersuite
       comm_id: msg.comm_id
         config: msg.config
         expiry: msg.expiry
         signature: msg.signature
         supports: msg.supports
</pre><a href="#section-3.4.1-1.4.2.1.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.4.1-1.4.2.2">
                  <p id="section-3.4.1-1.4.2.2.1">Updates <code>server_id.previous</code> to be equal to a structure of the
form:<a href="#section-3.4.1-1.4.2.2.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.1-1.4.2.2.2">
<pre>
   struct {
     Ciphersuite ciphersuite = current.ciphersuite
     int16 comm_id = current.comm_id
   }
</pre><a href="#section-3.4.1-1.4.2.2.2" class="pilcrow">¶</a>
</div>
<p id="section-3.4.1-1.4.2.2.3">
where the <code>Ciphersuite</code> struct is described in
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>.<a href="#section-3.4.1-1.4.2.2.3" class="pilcrow">¶</a></p>
</li>
<li id="section-3.4.1-1.4.2.3">
                  <p id="section-3.4.1-1.4.2.3.1">Updates <code>server_id.current</code> to be equal to a structure of the form:<a href="#section-3.4.1-1.4.2.3.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.1-1.4.2.3.2">
<pre>
   struct {
     Ciphersuite ciphersuite = msg.ciphersuite
     int16 comm_id = msg.comm_id
   }
</pre><a href="#section-3.4.1-1.4.2.3.2" class="pilcrow">¶</a>
</div>
</li>
<li id="section-3.4.1-1.4.2.4">Appends the current time to the vector of datetime values in
<code>server_id.modified</code>.<a href="#section-3.4.1-1.4.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
</section>
</div>
<div id="interface-cfg-retrieval">
<section id="section-3.4.2">
          <h4 id="name-global_config_retrieval">
<a href="#section-3.4.2" class="section-number selfRef">3.4.2. </a><a href="#name-global_config_retrieval" class="section-name selfRef">GLOBAL_CONFIG_RETRIEVAL</a>
          </h4>
<ul>
<li id="section-3.4.2-1.1">Visibility: <code>external</code><a href="#section-3.4.2-1.1" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.2">Input: a <code>config_retrieval</code> message <code>msg</code> (<a href="#msg-config-update" class="xref">Appendix A.3.1</a>).<a href="#section-3.4.2-1.2" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.3">Returns: a <code>config_retrieval_resp</code> message
(<a href="#msg-config-retrieval-resp" class="xref">Appendix A.3.3</a>).<a href="#section-3.4.2-1.3" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.4">
              <p id="section-3.4.2-1.4.1">Steps:<a href="#section-3.4.2-1.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.4.2-1.4.2">
                <li id="section-3.4.2-1.4.2.1">Retrieve the data structure <code>server_ds</code> from the global config
registry, keyed by <code>msg.server_id</code>.<a href="#section-3.4.2-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.4.2.2">Let <code>current=server_ds[current.ciphersuite][current.comm_id]</code><a href="#section-3.4.2-1.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.4.2.3">Let <code>previous=server_ds[previous.ciphersuite][previous.comm_id]</code><a href="#section-3.4.2-1.4.2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.4.2-1.4.2.4">
                  <p id="section-3.4.2-1.4.2.4.1">Return a <code>config_retrieval_resp</code> message of the form below, to the
querying interface.<a href="#section-3.4.2-1.4.2.4.1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2-1.4.2.4.2">
<pre>
   cfg_0 = config_entry {
     ciphersuite: current.ciphersuite,
     comm_id: current.comm_id,
     config: current.config,
     expiry: current.expiry,
     signature: current.signature,
     supports: current.supports,
   };
   cfg_1 = config_entry {
     ciphersuite: current.ciphersuite,
     comm_id: current.comm_id,
     config: current.config,
     expiry: current.expiry,
     signature: current.signature,
     supports: current.supports,
   };
   resp = config_retrieval_resp {
     configs: [cfg_0, cfg_1],
   }
</pre><a href="#section-3.4.2-1.4.2.4.2" class="pilcrow">¶</a>
</div>
</li>
</ol>
</li>
</ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="key-mgmt">
<section id="section-4">
      <h2 id="name-key-management-framework">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-management-framework" class="section-name selfRef">Key management framework</a>
      </h2>
<p id="section-4-1">Rather than sending the result of the key initialisation procedure
directly to each client, it is preferable for a server to upload its
current configurations to a trusted, tamper-proof, history-preserving
registry. By trusted, we mean from the perspective of clients that use
the Privacy Pass protocol. Any new keys uploaded to the registry should
be appended to the list. Any keys that have expired can optionally be
labelled as so, but should never be removed. A trusted registry may hold
key commitments for multiple Privacy Pass service providers (servers).<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">As we discuss in <a href="#privacy" class="xref">Section 6</a>, the implementation of the key management
policy has a major impact on the privacy properties of the Privacy Pass
ecosystem that it belongs to.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">To prevent unauthorized modification of the trusted registry, server's
should be required to identify and authenticate themselves before they
can append data to their configuration. Moreover, only parts of the
registry that correspond to the servers configuration can be modifiable.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">We intend for the registry that we describe to be fulfilled by existing
frameworks, such as Key Transparency <span>[<a href="#keytrans" class="xref">keytrans</a>]</span> or other similar
architectures.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="global">
<section id="section-4.1">
        <h3 id="name-global-configuration">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-global-configuration" class="section-name selfRef">Global configuration</a>
        </h3>
<p id="section-4.1-1">As alluded to above, key management for the Privacy Pass ecosystem
should be controlled by a single global key configuration registry. This
registry must be available at a publicly-known address and MUST hold all
of the configuration data for all of the Privacy Pass servers in the
ecosystem. Supporting more than one configuration registry could lead to
privacy concerns.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The registry MUST support the interfaces constructed in
<a href="#config-interfaces" class="xref">Section 3.4</a>.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="config-structure">
<section id="section-4.2">
        <h3 id="name-configuration-structure">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-configuration-structure" class="section-name selfRef">Configuration structure</a>
        </h3>
<p id="section-4.2-1">The global config registry is organized as a key-value store
corresponding to all of the configurations supported by all of the
recognized servers that are part of the Privacy Pass ecosystem. The
structure of the configuration takes the form below.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2-2">
<pre>
server_id: &lt;server_id_1&gt;
  verification_key: &lt;verification_key&gt;
  current: &lt;current&gt;
  previous: &lt;previous&gt;
  modified: &lt;modified&gt;
  ciphersuite: &lt;ciphersuite_1&gt;
    comm_id: &lt;comm_id_1&gt;
      config: &lt;config&gt;
      expiry: &lt;expiry&gt;
      supports: &lt;supports&gt;
      signature: &lt;signature&gt;

    .
    .
    .

    comm_id: &lt;comm_id_z&gt;
      config: &lt;config&gt;
      expiry: &lt;expiry&gt;
      supports: &lt;supports&gt;
      signature: &lt;signature&gt;
  .
  .
  .

  ciphersuite: &lt;ciphersuite_y&gt;
    ...
.
.
.

server_id: &lt;server_id_x&gt;
  ...
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">Essentially, each server corresponds to a single <code>server_id</code> and
<code>ciphersuite</code> corresponds to the different ciphersuites that the server
can use. Each configuration is defined by the data in the <code>config</code>,
<code>expiry</code>, <code>supports</code> and <code>signature</code> fields. The <code>config</code> field contains
the data represented in the <code>ServerUpdate</code> struct
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>, for example including the public key
<code>pub_key</code> of the server, and the value of <code>max_evals</code>.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Each server defines a separate verification key in the
<code>verification_key</code> field corresponding to the long-term signing key that
is used for signing each of the individual configurations and <code>comm_id</code>
values that it possesses.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">The <code>current</code>, <code>previous</code> and <code>modified</code> fields are the only fields that
change during configuration updates. The <code>current</code> field refers to the
latest configuration to support token issuance. The <code>previous</code> field is
used for a single configuration that still permits redemption of tokens,
this is used for ensuring that key rotations are smooth for clients. The
<code>modified</code> field refers to a vector of all times when the configuration
was modified.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="configuration-updates-config-update">
<section id="section-4.3">
        <h3 id="name-configuration-updates-confi">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-configuration-updates-confi" class="section-name selfRef">Configuration updates #{config-update}</a>
        </h3>
<p id="section-4.3-1">Whenever a server wants to rotate their current configuration, they must
create a request to append their new configuration to the trusted
registry. This request is handled by the global registry to update the
configuration, see the <code>GLOBAL_CONFIG_UPDATE</code> interface.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Each update results in adding a new config underneath an existing
<code>&lt;ciphersuite&gt;</code> with a new <code>&lt;comm_id&gt;</code> parameter, or a new
<code>&lt;ciphersuite&gt;</code> entry. The global config registry also updates, the
<code>current</code>, <code>previous</code> and <code>modified</code> fields to indicate that the change
has occurred.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">For reasons that are addressed more closely in <a href="#privacy" class="xref">Section 6</a>, the global
configuration registry must ensure that the only configurations that
are used at any given time, are those referred to in <code>current</code> and
<code>previous</code>. This is done to ensure that the server is not able to serve
tokens to clients from multiple different configurations (which could be
used to decrease the size of client anonymity sets).<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">All fields apart from the three referenced above MUST never be modified.
If a server wants to rotate the long-term <code>verification_key</code> it must
create a new server identity.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-retrieval">
<section id="section-4.4">
        <h3 id="name-client-retrieval">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-client-retrieval" class="section-name selfRef">Client retrieval</a>
        </h3>
<p id="section-4.4-1">Clients can either choose to:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.4-2.1">poll the trusted registry and import new keys, rejecting any that
throw errors;<a href="#section-4.4-2.1" class="pilcrow">¶</a>
</li>
<li id="section-4.4-2.2">retrieve the commitments for the server at the time at which they are
used, throwing errors if no valid commitment is available.<a href="#section-4.4-2.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.4-3">In the interfaces in <a href="#client-interfaces" class="xref">Section 3.3</a> we default to assuming that
the client retrieves the latest configuration as and when it is needed.
See the <code>CLIENT_CONFIG_RETRIEVAL</code> interface
(<a href="#interface-cli-retrieval" class="xref">Section 3.3.1</a>) for more details.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">The client checks that the configuration is consistent with the data it
receives from the server. It also checks the validity of the <code>signature</code>
field on the configuration that it retrieves. Later we also discuss
optionally checking the values in <code>modified</code> for trying to identify
malicious server behavior.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-revocation">
<section id="section-4.5">
        <h3 id="name-key-revocation">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-key-revocation" class="section-name selfRef">Key revocation</a>
        </h3>
<p id="section-4.5-1">Currently, key revocation is only supported by rotating the current
configuration. In the future, we may consider adding an explicit
mechanism for revoking a specific configuration (for example the active
redemption configuration referred to by <code>server_id.previous</code>) without
rotating the current issuance key.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="running-modes">
<section id="section-5">
      <h2 id="name-server-running-modes">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-server-running-modes" class="section-name selfRef">Server running modes</a>
      </h2>
<p id="section-5-1">We provide an overview of some of the possible frameworks for
configuring the way that servers run in the Privacy Pass ecosystem. In
short, servers may be configured to provide symmetric issuance and
redemption with clients. While some servers may be configured as proxies
that accept Privacy Pass data and send it to another server that
actually processes issuance and/or redemption data.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The intention with providing each of these running modes is to cover the
different applications that utilize variants of the Privacy Pass
protocol. We RECOMMEND that any Privacy Pass server implementation
adheres to one of these frameworks.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="sisv">
<section id="section-5.1">
        <h3 id="name-single-issuer-single-verifi">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-single-issuer-single-verifi" class="section-name selfRef">Single-Issuer Single-Verifier</a>
        </h3>
<p id="section-5.1-1">The simplest way of considering the Privacy Pass protocol is in a
setting where the same server plays the role of issuer and verifier, we
call this "Single-Issuer Single-Verifier" (SISV). In SISV, we consider a
server S that publishes commitments for their secret key k, that a
client C has access to.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">When S wants to issue tokens to C, they invoke the issuance protocol
where C generates their own inputs and S uses their secret key k. In
this setting, C can only perform token redemption with S. When a token
redemption is required, C and S invoke the redemption phase of the
protocol, where C uses an issued token from a previous exchange, and S
uses k as their input again.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">In SISV, C proves that S has attested to the honesty of C at some point
in the past (without revealing exactly when). S can use this information
to inform it's own decision-making about C without having to recompute
the trust attestation task again.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sifv">
<section id="section-5.2">
        <h3 id="name-single-issuer-forwarding-ve">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-single-issuer-forwarding-ve" class="section-name selfRef">Single-Issuer Forwarding-Verifier</a>
        </h3>
<p id="section-5.2-1">In this setting, each client C obtains issued tokens from a server S via
the issuance phase of the protocol. The difference is that clients can
prove that S has attested to their honesty in the past with any verifier
V. We still only consider S to hold their own secret key.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">When C interacts with V, V can ask C to provide proof that the separate
issuer S has attested to their trust. The first stage of the redemption
phase of the protocol is invoked between C and V, which sees C send the
unused token (x,y,aux) to V. This message is then used in a redemption
exchange between V and S, where V plays the role of the client. Then S
sends the result of the redemption exchange to V, and V uses this result
to determine whether C has the correct trust attestation.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">This configuration is known as "Single-Issuer Forwarding-Verifier" or
SIFV to refer to the verifier V who uses the output of the redemption
phase for their own decision-making.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="siav">
<section id="section-5.3">
        <h3 id="name-single-issue-asynchronous-v">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-single-issue-asynchronous-v" class="section-name selfRef">Single-Issue Asynchronous-Verifier</a>
        </h3>
<p id="section-5.3-1">This setting is inspired by recently proposed APIs such as <span>[<a href="#TRUST" class="xref">TRUST</a>]</span>. It
is similar to the SIFV configuration, except that the verifiers V no
longer interact with the issuer S. Only C interacts with S, and this is
done asynchronously to the trust attestation request from V. Hence
"Asynchronous-Verifier" (SIAV).<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">When V invokes a redemption for C, C then invokes a redemption exchange
with S in a separate session. If verification is carried out
successfully by S, S instead returns a Signed Redemption Record (SRR)
that contains the following information:<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-json" id="section-5.3-3">
<pre>
"result": {
  "timestamp":"2019-10-09-11:06:11",
  "verifier": "V",
},
"signature":sig,
</pre><a href="#section-5.3-3" class="pilcrow">¶</a>
</div>
<p id="section-5.3-4">The <code>signature</code> field carries a signature evaluated over the contents of
<code>result</code> using a long-term signing key for the issuer S, of which the
corresponding public key is well-known to C and V. Then C can prove that
their trust attestation from S to V by sending the SRR to V. The SRR can
be verified by V by verifying the signature using the well-known public
key for S.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">Such records can be cached to display again in the future. The issuer
can also add an expiry date to the record to determine when the client
must refresh the record.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="bi-mode">
<section id="section-5.4">
        <h3 id="name-bounded-issuers">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-bounded-issuers" class="section-name selfRef">Bounded-Issuers</a>
        </h3>
<p id="section-5.4-1">Each of the configurations above can be generalized to settings where a
bounded number of issuers are allowed, and verifiers can invoke trust
attestations for any of the available issuers. Subsequently, this leads
to three new configurations known as BISV, BIFV, BIAV.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">As we will discuss later in <a href="#privacy" class="xref">Section 6</a>, configuring a large number of
issuers can lead to privacy concerns for the clients in the ecosystem.
Therefore, we are careful to ensure that the number of issuers is kept
strictly bounded by a fixed small number M. The actual issuers can be
replaced with different issuers as long as the total never exceeds M.
Moreover, issuer replacements also have an effect on client privacy that
is similar to when a key rotation occurs, so replacement should only be
permitted at similar intervals.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">See <a href="#privacy" class="xref">Section 6</a> for more details about safe choices of M.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy">
<section id="section-6">
      <h2 id="name-privacy-analysis">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-privacy-analysis" class="section-name selfRef">Privacy analysis</a>
      </h2>
<p id="section-6-1">In the Privacy Pass protocol <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>, redemption
tokens intentionally encode no special information into redemption
tokens to prevent a vendor from learning anything about the client. We
also have cryptographic guarantees via the VOPRF construction that a
vendor can learn nothing about a client beyond which issuers trust it.
Still there are ways that malicious servers can try and learn
identifying information about clients that it interacts with.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">We discuss a number of privacy considerations relative to the Privacy
Pass ecosystem that we are constructing. In addition, we discuss
considerations arising from the specific ways of using the Privacy Pass
protocol in <a href="#running-modes" class="xref">Section 5</a>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="segregation">
<section id="section-6.1">
        <h3 id="name-user-segregation">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-user-segregation" class="section-name selfRef">User segregation</a>
        </h3>
<p id="section-6.1-1">The goal of the Privacy Pass ecosystem is to construct an environment
where can easily measure (and maximize) relative anonymity of any client
that is part of it. An inherent feature of being part of this ecosystem
is that any client can only remain private relative to the entire space
of users using the protocol. In principle, we would hope that the server
can link any client redemption to any specific issuance invocation with
a probability that is equivalent to guessing. However, in practice, the
server can increase this probability using a number of techniques that
can segregate the user space into smaller sets.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<div id="server-configuration-rotation">
<section id="section-6.1.1">
          <h4 id="name-server-configuration-rotati">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-server-configuration-rotati" class="section-name selfRef">Server configuration rotation</a>
          </h4>
<p id="section-6.1.1-1">Techniques to introduce segregation are closely linked to the type of
key schedule that is used by the server. When a server rotates their
key, any client that invokes the issuance protocol shortly afterwards
will be part of a small number of possible clients that can redeem. To
mechanize this attack strategy, a server could introduce a configuration
rotation policy which would force clients into smaller windows where a
given config is valid. This would mean that client privacy would only
have utility with respect to the smaller group of users that hold
redemption data for a particular key window.<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.1-2">We RECOMMEND that great care is taken over key rotations, in particular
server's should only invoke key rotation for fairly large periods of
time such as between 1 and 12 weeks. Key rotations represent a trade-off
between client privacy and continued server security. Therefore, it is
still important that key rotations occur on a fairly regular cycle to
reduce the harmfulness of a server key compromise.<a href="#section-6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.1-3">As we describe in <a href="#key-mgmt" class="xref">Section 4</a>, a trusted registries for holding Privacy
Pass configurations is required for policing the key schedule that a
server uses. Clients may choose to inspect the history of the registry
before first accepting redemption tokens from the server. Concrete
suggestions include the following:<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.1.1-4.1">If a server has updated the registry with many unexpired keys, or in
very quick intervals a client SHOULD reject the configuration. The
client can check this by checking the list of times when the server
modified their own configuration in the vector <code>modified</code>. This
prevents a server from segregating clients into smaller windows using
the redemption data that they hold.<a href="#section-6.1.1-4.1" class="pilcrow">¶</a>
</li>
<li id="section-6.1.1-4.2">If a server has only recently updated their configuration (within the
last few minutes), then the client SHOULD refuse to use it. This
prevents against a server that may try and deanonymize a specific
client.<a href="#section-6.1.1-4.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="issuers">
<section id="section-6.1.2">
          <h4 id="name-large-numbers-of-issuers">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-large-numbers-of-issuers" class="section-name selfRef">Large numbers of issuers</a>
          </h4>
<p id="section-6.1.2-1">Similarly to the configuration rotation issue raised above, if there are
a large number of issuers, similar user segregation can occur. In the
BISV, BIFV, BIAV configurations of using the Privacy Pass protocol
(<a href="#running-modes" class="xref">Section 5</a>), a verifier OV can trigger redemptions for any of
the available issuers. Each redemption token that a client holds
essentially corresponds to a bit of information about the client that OV
can learn. Therefore, there is an exponential loss in privacy relative
to the number of issuers that there are.<a href="#section-6.1.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2-2">For example, if there are 32 issuers, then OV learns 32 bits of
information about the client. If the distribution of issuer trust is
anything close to a uniform distribution, then this is likely to
uniquely identify any client amongst all other Internet users. Assuming
a uniform distribution is clearly the worst-case scenario, and unlikely
to be accurate, but it provides a stark warning against allowing too
many issuers at any one time.<a href="#section-6.1.2-2" class="pilcrow">¶</a></p>
<p id="section-6.1.2-3">As we noted in <a href="#bi-mode" class="xref">Section 5.4</a>, a strict bound should be applied to the
active number of issuers that are allowed at one time in the ecosystem.
We propose that allowing no more than 4 issuers at any one time is
highly preferable (leading to a maximum of 64 possible user
segregations). However, as highlighted in <a href="#parametrization" class="xref">Section 8</a>, having a
very large user base (&gt; 5 million users), could potentially allow for
larger values (for example, up to 8 issuers). Issuer replacements should
only occur with the same frequency as config rotations as they can lead
to similar losses in privacy if clients still hold redemption tokens for
previously active issuers.<a href="#section-6.1.2-3" class="pilcrow">¶</a></p>
<p id="section-6.1.2-4">In addition, we RECOMMEND that trusted registries indicate at all times
which issuers are deemed to be active. If a client is asked to invoke
any Privacy Pass exchange for an issuer that is not declared active,
then the client SHOULD refuse to retrieve the server configuration
during the protocol.<a href="#section-6.1.2-4" class="pilcrow">¶</a></p>
<div id="single-global-configuration-authority">
<section id="section-6.1.2.1">
            <h5 id="name-single-global-configuration">
<a href="#section-6.1.2.1" class="section-number selfRef">6.1.2.1. </a><a href="#name-single-global-configuration" class="section-name selfRef">Single global configuration authority</a>
            </h5>
<p id="section-6.1.2.1-1">Any Privacy Pass ecosystem MUST only contain a single global authority
for controlling and managing server configurations.<a href="#section-6.1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-2">This prevents servers from posting different configurations to different
global authorities that are all simultaneously trusted by the clients.
In such situations, the deanonymization potential would be similar to
providing multiple active configurations.<a href="#section-6.1.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="maximum-number-of-issuers-inferred-by-client">
<section id="section-6.1.2.2">
            <h5 id="name-maximum-number-of-issuers-i">
<a href="#section-6.1.2.2" class="section-number selfRef">6.1.2.2. </a><a href="#name-maximum-number-of-issuers-i" class="section-name selfRef">Maximum number of issuers inferred by client</a>
            </h5>
<p id="section-6.1.2.2-1">We RECOMMEND that clients only store redemption tokens for a fixed
number of issuers at any one time. This number would ideally be less
than the number of permitted active issuers.<a href="#section-6.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.2-2">This prevents a malicious verifier from being able to invoke redemptions
for many issuers since the client would only be holding redemption
tokens for a small set of issuers. When a client is issued tokens from a
new issuer and already has tokens from the maximum number of issuers, it
simply deletes the oldest set of redemption tokens in storage and then
stores the newly acquired tokens.<a href="#section-6.1.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="tracking-and-identity-leakage">
<section id="section-6.2">
        <h3 id="name-tracking-and-identity-leaka">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-tracking-and-identity-leaka" class="section-name selfRef">Tracking and identity leakage</a>
        </h3>
<p id="section-6.2-1">While redemption tokens themselves encode no information about the
client redeeming them, problems may occur if too many redemptions are
allowed in a short burst. For instance, in the Internet setting, this
may allow non-terminating verifiers to learn more information from the
metadata that the client may hold (such as first-party cookies for other
domains). Mitigations for this issue are similar to those proposed in
<a href="#issuers" class="xref">Section 6.1.2</a> for tackling the problem of having large number of issuers.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">In SIAV, cached SRRs and their associated issuer public keys have a
similar tracking potential to first party cookies in the browser
setting. These considerations will be covered in a separate document
detailing Privacy Pass protocol integration into the wider web
architecture <span>[<a href="#draft-svaldez-pp-http-api" class="xref">draft-svaldez-pp-http-api</a>]</span>.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-incentives-for-anonymity-reduction">
<section id="section-6.3">
        <h3 id="name-client-incentives-for-anony">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-client-incentives-for-anony" class="section-name selfRef">Client incentives for anonymity reduction</a>
        </h3>
<p id="section-6.3-1">Clients may see an incentive in accepting all tokens that are issued by
a server, even if the tokens fail later verification checks. This is
because tokens effectively represent a form of currency that they can
later redeem for some sort of benefit. The verification checks that are
put in place are there to ensure that the client does not sacrifice
their anonymity. However, a client may judge the "monetary" benefit of
owning tokens to be greater than their own privacy.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Firstly, none of the interfaces that we have described permit this type
of behavior, as they utilize the underlying Privacy Pass API that
carries out this verification. A client behaving in this way would not
be compliant with the protocol.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">Secondly, acting in this way only affects the privacy of the immediate
client. There is an exception if a large number of clients colluded to
accept bad data, then any client that didn't accept would be part of a
smaller anonymity set. However, such an situation would be identical to
the situation where the total number of clients in the ecosystem is
small. Therefore, the privacy impact would be equivalent; see
<a href="#issuers" class="xref">Section 6.1.2</a> for more details.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<p id="section-7-1">We present a number of security considerations that prevent a malicious
actors from abusing the protocol.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="double-spend-protection">
<section id="section-7.1">
        <h3 id="name-double-spend-protection">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-double-spend-protection" class="section-name selfRef">Double-spend protection</a>
        </h3>
<p id="section-7.1-1">All issuing server should implement a robust storage-query mechanism for
checking that tokens sent by clients have not been spent before. Such
tokens only need to be checked for each issuer individually. But all
issuers must perform global double-spend checks to avoid clients from
exploiting the possibility of spending tokens more than once against
distributed token checking systems. For the same reason, the global data
storage must have quick update times. While an update is occurring it
may be possible for a malicious client to spend a token more than once.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="configuration-rotation">
<section id="section-7.2">
        <h3 id="name-configuration-rotation">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-configuration-rotation" class="section-name selfRef">Configuration rotation</a>
        </h3>
<p id="section-7.2-1">We highlighted previously that short configuration-cycles can be used to
reduce client privacy. However, regular key rotations are still
recommended to maintain good server key hygiene. The key material that
we consider to be important are:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-7.2-2.1">the Server secret key for issuing Privacy Pass data;<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
<li id="section-7.2-2.2">the signing key used to sign configuration information;<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
<li id="section-7.2-2.3">the signing key used to sign SRRs in the SIAV configuration.<a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-7.2-3">We recommend that Privacy Pass secret keys are rotated from anywhere
between 1 and 12 weeks. With an active user-base, a week gives a fairly
large window for clients to participate in the Privacy Pass protocol and
thus enjoy the privacy guarantees of being part of a larger group. The
low ceiling of 12 weeks prevents a key compromise from being too
destructive. If a server realizes that a key compromise has occurred
then the server should revoke the previous key in the trusted registry
and specify a new key to be used.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">For the two signing keys, these should both be well-known keys
associated with the issuer. Issuers may choose to use the same key for
both signing purposes. The rotation schedules for these keys can be much
longer, if necessary. Rotations of these keys results in the creation of
a new server identity.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-exhaustion">
<section id="section-7.3">
        <h3 id="name-token-exhaustion">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-token-exhaustion" class="section-name selfRef">Token exhaustion</a>
        </h3>
<p id="section-7.3-1">When a client holds tokens for an issuer, it is possible for any
verifier to invoke that client to redeem tokens for that issuer. This
can lead to an attack where a malicious verifier can force a client to
spend all of their tokens for a given issuer. To prevent this from
happening, methods should be put into place to prevent many tokens from
being redeemed at once.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">For example, it may be possible to cache a redemption for the entity
that is invoking a token redemption. In SISV/SIFV, if the verifier
requests more tokens then the client simply returns the cached token
that it returned previously. This could also be handled by simply not
redeeming any tokens for the entity if a redemption had already occurred
in a given time window.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">In SIAV, the client instead caches the SRR that it received in the
asynchronous redemption exchange with the issuer. If the same verifier
attempts another redemption request, then the client simply returns the
cached SRR. The SRRs can be revoked by the issuer, if need be, by
providing an expiry date or by signaling that records from a particular
window need to be refreshed.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="parametrization">
<section id="section-8">
      <h2 id="name-protocol-parametrization">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-protocol-parametrization" class="section-name selfRef">Protocol parametrization</a>
      </h2>
<p id="section-8-1">We provide a summary of the parameters that we use in the Privacy Pass
protocol ecosystem. These parameters are informed by both privacy and
security considerations that are highlighted in <a href="#privacy" class="xref">Section 6</a> and
<a href="#security" class="xref">Section 7</a>, respectively. These parameters are intended as a single
reference point for those implementing the protocol.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Firstly, let U be the total number of users, I be the total number of
issuers. Assuming that each user accept tokens from a uniform sampling
of all the possible issuers, as a worst-case analysis, this segregates
users into a total of 2^I buckets. As such, we see an exponential
reduction in the size of the anonymity set for any given user. This
allows us to specify the privacy constraints of the protocol below,
relative to the setting of A.<a href="#section-8-2" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">parameter</th>
            <th class="text-left" rowspan="1" colspan="1">value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Minimum anonymity set size (A)</td>
            <td class="text-left" rowspan="1" colspan="1">5000</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Recommended key lifetime (L)</td>
            <td class="text-left" rowspan="1" colspan="1">2 - 24 weeks</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Recommended key rotation frequency (F)</td>
            <td class="text-left" rowspan="1" colspan="1">L/2</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Maximum allowed issuers (I)</td>
            <td class="text-left" rowspan="1" colspan="1">log_2(U/A)-1</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Maximum active issuance configurations</td>
            <td class="text-left" rowspan="1" colspan="1">1</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Maximum active redemption configurations</td>
            <td class="text-left" rowspan="1" colspan="1">2</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Minimum cryptographic security parameter</td>
            <td class="text-left" rowspan="1" colspan="1">128 bits</td>
          </tr>
        </tbody>
      </table>
<div id="justification">
<section id="section-8.1">
        <h3 id="name-justification">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-justification" class="section-name selfRef">Justification</a>
        </h3>
<p id="section-8.1-1">We make the following assumptions in these parameter choices.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.1-2.1">Inferring the identity of a user in a 5000-strong anonymity set is
difficult<a href="#section-8.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.2">After 2 weeks, all clients in a system will have rotated to the new
key<a href="#section-8.1-2.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.1-3">The maximum choice of I is based on the equation 1/2 * U/2^I = A. This
is because I issuers lead to 2^I segregations of the total user-base U.
By reducing I we limit the possibility of performing the attacks
mentioned in <a href="#segregation" class="xref">Section 6.1</a>.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">We must also account for each user holding issued data for more then one
possible active keys. While this may also be a vector for monitoring the
access patterns of clients, it is likely to unavoidable that clients
hold valid issuance data for the previous key epoch. This also means
that the server can continue to verify redemption data for a previously
used key. This makes the rotation period much smoother for clients.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">For privacy reasons, it is recommended that key epochs are chosen that
limit clients to holding issuance data for a maximum of two keys. By
choosing F = L/2 then the minimum value of F is a week, since the
minimum recommended value of L is 2 weeks. Therefore, by the initial
assumption, then all users should only have access to only two keys at
any given time. This reduces the anonymity set by another half at most.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<p id="section-8.1-6">Finally, the minimum security parameter size is related to the
cryptographic security offered by the protocol that is run. This
parameter corresponds to the number of operations that any adversary has
in breaking one of the security guarantees in the Privacy Pass protocol
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>. The existing protocol document contains
an instantiation based on verifiable oblivious pseudorandom functions
(VOPRFs) <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span>. Careful attention should be paid to
whether the available ciphersuites for a protocol instantiation meets
this criteria.<a href="#section-8.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-parameterization">
<section id="section-8.2">
        <h3 id="name-example-parameterization">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-example-parameterization" class="section-name selfRef">Example parameterization</a>
        </h3>
<p id="section-8.2-1">Using the specification above, we can give some example
parameterizations. For example, the current Privacy Pass browser
extension <span>[<a href="#PPEXT" class="xref">PPEXT</a>]</span> has over 150,000 active users (from Chrome and
Firefox). As a result, log_2(U/A) is approximately 5 and so the maximum
value of I should be 4.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">If the value of U is much bigger (e.g. 5 million) then this would permit
I = log_2(5000000/5000)-1 = 8 issuers.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="recs-srvr">
<section id="section-9">
      <h2 id="name-recommendations-for-identif">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-recommendations-for-identif" class="section-name selfRef">Recommendations for identifying malicious behavior</a>
      </h2>
<p id="section-9-1">TODO: Come up with an effective deterrent for server's that are deemed
to misbehave by a client. Could we have a separate consensus where
clients can upload misbehavior references for servers that they deem to
be malicious?<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extensions">
<section id="section-10">
      <h2 id="name-extension-integration-polic">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-extension-integration-polic" class="section-name selfRef">Extension integration policy</a>
      </h2>
<p id="section-10-1">The Privacy Pass protocol and ecosystem are both intended to be
receptive to extensions that expand the current set of functionality. In
<span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>, some points are made about how
implementing the Privacy Pass API can be instantiated using different
underlying primitives. The interfaces described in <a href="#integration" class="xref">Section 3</a>
utilize the API in such a way that internal changes should result in no
visible change to implementers of the Privacy Pass protocol.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">As specified in <span>[<a href="#draft-davidson-pp-protocol" class="xref">draft-davidson-pp-protocol</a>]</span>, all extensions to the
Privacy Pass protocol SHOULD be specified as separate documents that
modify the content of this document in some way. We provide guidance on
the type of modifications that are possible in the following.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">Aside from the underlying protocol, extensions MAY modify the protocol
interfaces from the definition in this document. Such extensions MUST
document exactly which interfaces are changed and any new message
formats that arise. Any such extension should also come with a detailed
analysis of the privacy impacts of the extension, why these impacts are
justified, and guidelines on changes to the parametrization in
<a href="#parametrization" class="xref">Section 8</a>. Similarly, extensions MAY also add new Server
running modes, if applicable, to those that are documented in
<a href="#running-modes" class="xref">Section 5</a>.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">We RECOMMEND that any extension to the Privacy Pass architecture does
not add new interfaces to those that are listed in <a href="#integration" class="xref">Section 3</a>. We
expect that any extension is expressible using the interfaces themselves
and reimplementing the existing functionality, if need be. Abiding by
this policy maintains a simplified execution chain that is easy to
reason about.<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">Extensions MUST NOT modify the format and/or structure of the global
configuration registry, other than specifying the data format of each of
the fields that are used. If an extension requires a modified
configuration registry, then such a change is interpreted to lie outside
of the Privacy Pass ecosystem, and is thus not supported.<a href="#section-10-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="applications">
<section id="section-11">
      <h2 id="name-existing-applications">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-existing-applications" class="section-name selfRef">Existing applications</a>
      </h2>
<p id="section-11-1">The following is a non-exhaustive list of applications that currently
make use of the Privacy Pass protocol, or some variant of the underlying
functionality.<a href="#section-11-1" class="pilcrow">¶</a></p>
<div id="cloudflare-challenge-pages">
<section id="section-11.1">
        <h3 id="name-cloudflare-challenge-pages">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-cloudflare-challenge-pages" class="section-name selfRef">Cloudflare challenge pages</a>
        </h3>
<p id="section-11.1-1">Cloudflare uses an implementation of the Privacy Pass protocol for
allowing clients that have previously interacted with their Internet
challenge protection system to bypass future challenges <span>[<a href="#PPSRV" class="xref">PPSRV</a>]</span>. These
challenges can be expensive for clients, and there have been cases where
bugs in the implementations can severely degrade client accessibility.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">Clients must install a browser extension <span>[<a href="#PPEXT" class="xref">PPEXT</a>]</span> that acts as the
Privacy Pass client in an exchange with Cloudflare's Privacy Pass
server, when an initial challenge solution is provided. The client
extension stores the issued tokens and presents a valid redemption token
when it sees future Cloudflare challenges. If the redemption token is
verified by the server, the client passes through the security mechanism
without completing a challenge.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trust-token-api">
<section id="section-11.2">
        <h3 id="name-trust-token-api">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-trust-token-api" class="section-name selfRef">Trust Token API</a>
        </h3>
<p id="section-11.2-1">The Trust Token API <span>[<a href="#TRUST" class="xref">TRUST</a>]</span> has been devised as a generic API for
providing Privacy Pass functionality in the browser setting. The API is
intended to be implemented directly into browsers so that server's can
directly trigger the Privacy Pass workflow.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="zero-knowledge-access-passes">
<section id="section-11.3">
        <h3 id="name-zero-knowledge-access-passe">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-zero-knowledge-access-passe" class="section-name selfRef">Zero-knowledge Access Passes</a>
        </h3>
<p id="section-11.3-1">The PrivateStorage API developed by Least Authority is a solution for
uploading and storing end-to-end encrypted data in the cloud. A recent
addition to the API <span>[<a href="#PrivateStorage" class="xref">PrivateStorage</a>]</span> allows clients to generate
Zero-knowledge Access Passes (ZKAPs) attesting to the fact that the
client has paid for the storage space that it is using. The ZKAP
protocol is based heavily on the Privacy Pass redemption mechanism. The
client receives ZKAPs when it pays for storage space, and redeems the
passes when it interacts with the PrivateStorage API.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="basic-attention-tokens">
<section id="section-11.4">
        <h3 id="name-basic-attention-tokens">
<a href="#section-11.4" class="section-number selfRef">11.4. </a><a href="#name-basic-attention-tokens" class="section-name selfRef">Basic Attention Tokens</a>
        </h3>
<p id="section-11.4-1">The browser Brave uses Basic Attention Tokens (BATs) to provide the
basis for a privacy-preserving rewards scheme <span>[<a href="#Brave" class="xref">Brave</a>]</span>. The BATs are
essentially Privacy Pass redemption tokens that are provided by a
central Brave server when a client performs some action that triggers a
reward event (such as watching an advertisement). When the client
amasses BATs, it can redeem them with the Brave central server for
rewards.<a href="#section-11.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-based-services">
<section id="section-11.5">
        <h3 id="name-token-based-services">
<a href="#section-11.5" class="section-number selfRef">11.5. </a><a href="#name-token-based-services" class="section-name selfRef">Token Based Services</a>
        </h3>
<p id="section-11.5-1">Similarly to BATs, a more generic approach for providing anonymous peers
to purchase resources from anonymous servers has been proposed
<span>[<a href="#OpenPrivacy" class="xref">OpenPrivacy</a>]</span>. The protocol is based on a variant of Privacy Pass and
is intended to allow clients purchase (or pre-purchase) services such as
message hosting, by using Privacy Pass redemption tokens as a form of
currency. This is also similar to how ZKAPs are used.<a href="#section-11.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="draft-davidson-pp-protocol">[draft-davidson-pp-protocol]</dt>
<dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refTitle">"Privacy Pass: The Protocol"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-davidson-pp-protocol-00">https://tools.ietf.org/html/draft-davidson-pp-protocol-00</a>&gt;</span>. </dd>
<dt id="draft-svaldez-pp-http-api">[draft-svaldez-pp-http-api]</dt>
<dd>
<span class="refAuthor">Valdez, S.</span>, <span class="refTitle">"Privacy Pass: HTTP API"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://github.com/alxdavids/privacy-pass-ietf/tree/master/drafts/draft-svaldez-pp-http-api">https://github.com/alxdavids/privacy-pass-ietf/tree/master/drafts/draft-svaldez-pp-http-api</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC8446">[RFC8446]</dt>
<dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dt id="X9.62">[X9.62]</dt>
<dd>
<span class="refAuthor">Institute, A.N.S.</span>, <span class="refTitle">"Public Key Cryptography for the Financial Services Industry: The Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">ANSI X9.62-2005 </span>, <time datetime="2005-11">November 2005</time>. </dd>
</dl>
</section>
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Brave">[Brave]</dt>
<dd>
<span class="refTitle">"Brave Rewards"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://brave.com/brave-rewards/">https://brave.com/brave-rewards/</a>&gt;</span>. </dd>
<dt id="I-D.irtf-cfrg-voprf">[I-D.irtf-cfrg-voprf]</dt>
<dd>
<span class="refAuthor">Davidson, A.</span><span class="refAuthor">, Sullivan, N.</span><span class="refAuthor">, and C. Wood</span>, <span class="refTitle">"Oblivious Pseudorandom Functions (OPRFs) using Prime-Order Groups"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-voprf-03</span>, <time datetime="2020-03-09">9 March 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-irtf-cfrg-voprf-03.txt">http://www.ietf.org/internet-drafts/draft-irtf-cfrg-voprf-03.txt</a>&gt;</span>. </dd>
<dt id="keytrans">[keytrans]</dt>
<dd>
<span class="refTitle">"Security Through Transparency"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://security.googleblog.com/2017/01/security-through-transparency.html">https://security.googleblog.com/2017/01/security-through-transparency.html</a>&gt;</span>. </dd>
<dt id="OpenPrivacy">[OpenPrivacy]</dt>
<dd>
<span class="refTitle">"Token Based Services - Differences from PrivacyPass"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://openprivacy.ca/assets/towards-anonymous-prepaid-services.pdf">https://openprivacy.ca/assets/towards-anonymous-prepaid-services.pdf</a>&gt;</span>. </dd>
<dt id="PPEXT">[PPEXT]</dt>
<dd>
<span class="refTitle">"Privacy Pass Browser Extension"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://github.com/privacypass/challenge-bypass-extension">https://github.com/privacypass/challenge-bypass-extension</a>&gt;</span>. </dd>
<dt id="PPSRV">[PPSRV]</dt>
<dd>
<span class="refAuthor">Sullivan, N.</span>, <span class="refTitle">"Cloudflare Supports Privacy Pass"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://blog.cloudflare.com/cloudflare-supports-privacy-pass/">https://blog.cloudflare.com/cloudflare-supports-privacy-pass/</a>&gt;</span>. </dd>
<dt id="PrivateStorage">[PrivateStorage]</dt>
<dd>
<span class="refAuthor">Steininger, L.</span>, <span class="refTitle">"The Path from S4 to PrivateStorage"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://medium.com/least-authority/the-path-from-s4-to-privatestorage-ae9d4a10b2ae">https://medium.com/least-authority/the-path-from-s4-to-privatestorage-ae9d4a10b2ae</a>&gt;</span>. </dd>
<dt id="TRUST">[TRUST]</dt>
<dd>
<span class="refAuthor">WICG, .</span>, <span class="refTitle">"Trust Token API"</span>, <time datetime="n.d.">n.d.</time>, <span>&lt;<a href="https://github.com/WICG/trust-token-api">https://github.com/WICG/trust-token-api</a>&gt;</span>. </dd>
</dl>
</section>
</section>
<div id="message-formats">
<section id="section-appendix.a">
      <h2 id="name-message-formats">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-message-formats" class="section-name selfRef">Message formats</a>
      </h2>
<p id="section-appendix.a-1">We detail an exhaustive list of the different message types used in the
Privacy Pass protocol. These messages are sent and received by the
interfaces detailed in <a href="#integration" class="xref">Section 3</a>. We intend for the messages to be
compatible typical message expression formats such as JSON.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<div id="server-messages">
<section id="section-a.1">
        <h2 id="name-server-messages">
<a href="#section-a.1" class="section-number selfRef">A.1. </a><a href="#name-server-messages" class="section-name selfRef">Server messages</a>
        </h2>
<div id="msg-config-store">
<section id="section-a.1.1">
          <h3 id="name-server_config_store">
<a href="#section-a.1.1" class="section-number selfRef">A.1.1. </a><a href="#name-server_config_store" class="section-name selfRef">server_config_store</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.1.1-1">
<pre>
struct {
  ServerConfig configs[2];
} server_config_store
</pre><a href="#section-a.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-config-retrieve">
<section id="section-a.1.2">
          <h3 id="name-server_config_retrieve">
<a href="#section-a.1.2" class="section-number selfRef">A.1.2. </a><a href="#name-server_config_retrieve" class="section-name selfRef">server_config_retrieve</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.1.2-1">
<pre>
struct {
  uint8 method;
  ServerConfig configs[2];
} server_config_retrieve
</pre><a href="#section-a.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-server-hello">
<section id="section-a.1.3">
          <h3 id="name-server_hello-2">
<a href="#section-a.1.3" class="section-number selfRef">A.1.3. </a><a href="#name-server_hello-2" class="section-name selfRef">server_hello</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.1.3-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  uint8 supports;
} server_hello
</pre><a href="#section-a.1.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-server-issue-resp">
<section id="section-a.1.4">
          <h3 id="name-server_issue_resp">
<a href="#section-a.1.4" class="section-number selfRef">A.1.4. </a><a href="#name-server_issue_resp" class="section-name selfRef">server_issue_resp</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.1.4-1">
<pre>
struct {
  IssuanceResponse data;
} server_issue_resp
</pre><a href="#section-a.1.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-server-redeem-resp">
<section id="section-a.1.5">
          <h3 id="name-server_redeem_resp">
<a href="#section-a.1.5" class="section-number selfRef">A.1.5. </a><a href="#name-server_redeem_resp" class="section-name selfRef">server_redeem_resp</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.1.5-1">
<pre>
struct {
  RedemptionResponse data;
} server_redeem_resp
</pre><a href="#section-a.1.5-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="client-message-formats">
<section id="section-a.2">
        <h2 id="name-client-message-formats">
<a href="#section-a.2" class="section-number selfRef">A.2. </a><a href="#name-client-message-formats" class="section-name selfRef">Client message formats</a>
        </h2>
<div id="msg-client-issue-generation">
<section id="section-a.2.1">
          <h3 id="name-client_issue_generation">
<a href="#section-a.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-client_issue_generation" class="section-name selfRef">client_issue_generation</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.1-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  ServerUpdate config;
} client_issue_generation
</pre><a href="#section-a.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-issue-storage">
<section id="section-a.2.2">
          <h3 id="name-client_issue_storage-2">
<a href="#section-a.2.2" class="section-number selfRef">A.2.2. </a><a href="#name-client_issue_storage-2" class="section-name selfRef">client_issue_storage</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.2-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;
  Ciphersuite ciphersuite;
  opaque comm_id&lt;0..2^16-1&gt;;
  ClientIssuanceProcessing client_data;
} client_issue_storage
</pre><a href="#section-a.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-issue">
<section id="section-a.2.3">
          <h3 id="name-client_issue">
<a href="#section-a.2.3" class="section-number selfRef">A.2.3. </a><a href="#name-client_issue" class="section-name selfRef">client_issue</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.3-1">
<pre>
struct {
  opaque client_id&lt;0..2^16-1&gt;;
  IssuanceMessage issue_data;
} client_issue
</pre><a href="#section-a.2.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-issue-retrieval">
<section id="section-a.2.4">
          <h3 id="name-client_issue_retrieval-2">
<a href="#section-a.2.4" class="section-number selfRef">A.2.4. </a><a href="#name-client_issue_retrieval-2" class="section-name selfRef">client_issue_retrieval</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.4-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  Ciphersuite ciphersuite;
  opaque comm_id&lt;0..2^16-1&gt;;
} client_issue_retrieval
</pre><a href="#section-a.2.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-issue-retrieval-resp">
<section id="section-a.2.5">
          <h3 id="name-client_issue_retrieval_resp">
<a href="#section-a.2.5" class="section-number selfRef">A.2.5. </a><a href="#name-client_issue_retrieval_resp" class="section-name selfRef">client_issue_retrieval_resp</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.5-1">
<pre>
struct {
  ClientIssuanceProcessing client_data;
} client_issue_retrieval_resp
</pre><a href="#section-a.2.5-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-token-storage">
<section id="section-a.2.6">
          <h3 id="name-client_token_storage-2">
<a href="#section-a.2.6" class="section-number selfRef">A.2.6. </a><a href="#name-client_token_storage-2" class="section-name selfRef">client_token_storage</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.6-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  Ciphersuite ciphersuite;
  opaque comm_id&lt;0..2^16-1&gt;;
  RedemptionToken tokens[m];
} client_token_storage
</pre><a href="#section-a.2.6-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-token-retrieval">
<section id="section-a.2.7">
          <h3 id="name-client_token_retrieval-2">
<a href="#section-a.2.7" class="section-number selfRef">A.2.7. </a><a href="#name-client_token_retrieval-2" class="section-name selfRef">client_token_retrieval</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.7-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  Ciphersuite ciphersuite;
  opaque comm_id&lt;0..2^16-1&gt;;
} client_token_retrieval
</pre><a href="#section-a.2.7-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-token-retrieval-resp">
<section id="section-a.2.8">
          <h3 id="name-client_token_retrieval_resp">
<a href="#section-a.2.8" class="section-number selfRef">A.2.8. </a><a href="#name-client_token_retrieval_resp" class="section-name selfRef">client_token_retrieval_resp</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.8-1">
<pre>
method: "client_token_retrieval_resp"
struct {
  RedemptionToken token;
} client_token_retrieval_resp
</pre><a href="#section-a.2.8-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-redeem-generation">
<section id="section-a.2.9">
          <h3 id="name-client_redeem_generation">
<a href="#section-a.2.9" class="section-number selfRef">A.2.9. </a><a href="#name-client_redeem_generation" class="section-name selfRef">client_redeem_generation</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.9-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  ServeUpdate config;
  RedemptionToken token;
} client_redeem_generation
</pre><a href="#section-a.2.9-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-client-redeem">
<section id="section-a.2.10">
          <h3 id="name-client_redeem-2">
<a href="#section-a.2.10" class="section-number selfRef">A.2.10. </a><a href="#name-client_redeem-2" class="section-name selfRef">client_redeem</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.2.10-1">
<pre>
struct {
  opaque client_id&lt;0..2^16-1&gt;;
  RedemptionMessage message;
} client_redeem
</pre><a href="#section-a.2.10-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="global-configuration-interfaces">
<section id="section-a.3">
        <h2 id="name-global-configuration-interf">
<a href="#section-a.3" class="section-number selfRef">A.3. </a><a href="#name-global-configuration-interf" class="section-name selfRef">Global configuration interfaces</a>
        </h2>
<div id="msg-config-update">
<section id="section-a.3.1">
          <h3 id="name-config_update">
<a href="#section-a.3.1" class="section-number selfRef">A.3.1. </a><a href="#name-config_update" class="section-name selfRef">config_update</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.3.1-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
  opaque comm_id&lt;0..2^16-1&gt;;
  ServerUpdate config;
  datetime expiry;
  opaque signature&lt;1..2^32-1&gt;;
} config_update
</pre><a href="#section-a.3.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-config-retrieval">
<section id="section-a.3.2">
          <h3 id="name-config_retrieval">
<a href="#section-a.3.2" class="section-number selfRef">A.3.2. </a><a href="#name-config_retrieval" class="section-name selfRef">config_retrieval</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.3.2-1">
<pre>
struct {
  opaque server_id&lt;0..255&gt;;
} config_retrieval
</pre><a href="#section-a.3.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="msg-config-retrieval-resp">
<section id="section-a.3.3">
          <h3 id="name-config_retrieval_resp">
<a href="#section-a.3.3" class="section-number selfRef">A.3.3. </a><a href="#name-config_retrieval_resp" class="section-name selfRef">config_retrieval_resp</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-a.3.3-1">
<pre>
struct {
  Ciphersuite ciphersuite;
  opaque comm_id&lt;0..2^16-1&gt;;
  ServerUpdate config;
  datetime expiry;
  opaque signature&lt;1..2^32-1&gt;;
  uint8 supports;
} config_entry

struct {
  config_entry configs[2];
} config_retrieval_resp
</pre><a href="#section-a.3.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Alex Davidson</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare Portugal</span></div>
<div dir="auto" class="left"><span class="street-address">Largo Rafael Bordalo Pinheiro 29</span></div>
<div dir="auto" class="left"><span class="locality">Lisbon</span></div>
<div dir="auto" class="left"><span class="country-name">Portugal</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:alex.davidson92@gmail.com" class="email">alex.davidson92@gmail.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
